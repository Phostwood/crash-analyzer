<!DOCTYPE html>
<html lang="en">

<head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-5X8TRFYCFK"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
	  
		gtag('config', 'G-5X8TRFYCFK');
	  </script>
	  
	  <script type="text/javascript">
		  (function(c,l,a,r,i,t,y){
			  c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
			  t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
			  y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
		  })(window, document, "clarity", "script", "luzl3ap6kg");
	  </script>

	<title>Crash Log Analyzer</title>

	<meta charset="UTF-8">
	<meta name="version" content="0.13.2">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="icon" type="image/x-icon" href="https://phostwood.github.io/crash-analyzer/favicon.ico">
	<link rel="apple-touch-icon" sizes="180x180" href="https://phostwood.github.io/crash-analyzer/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://phostwood.github.io/crash-analyzer/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://phostwood.github.io/crash-analyzer/favicon-16x16.png">
	<link rel="manifest" href="https://phostwood.github.io/crash-analyzer/site.webmanifest">

	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300i,400,400i,700%7cMarcellus+SC"
		rel="stylesheet">

	<!-- Using stylesheet from Nolvus.net (with Vektor's permission) -->
	<link href="https://phostwood.github.io/crash-analyzer/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/turndown@7.0.0/dist/turndown.js"></script>

	<style>
		/* Fluid Typography Source: https://fluidtypography.com/  */

		/* SPECS:
viewport width range: 370 to 4000 px
line height range: 1.7 to 1.3 ("Smaller fonts require more line height, which is why you may want to specify a start line height that has a greater value than the end line height (assuming your font size is adjusting proportionally to the viewport's width)." and "For optimal readability and accessibility, try 140% to 180% (that's 1.4 to 1.8)." --> which I'm taking as meaning 1.8 to 1.4)

font size chart:
tag		min	max
code	14	18 (also for textarea)
body	16	22px (also used for button)
h6		17	26
h5		18	30
h4		19	34
h3		20	38
h2		22	42	
h1		24	48	(only heading actually used/specified below)
*/


		/* Fluid Typography Fonts */
		body,
		button {
			font-family: "Roboto Condensed", sans-serif;
			font-weight: 400;
			font-size: clamp(1rem, 0.165vw + 0.962rem, 1.375rem);
			line-height: clamp(1.7rem, 0.039vw + 1.691rem, 1.788rem);
		}

		code,
		textarea {
			font-family: monospace;
			font-size: clamp(0.875rem, 0.11vw + 0.85rem, 1.125rem);
			line-height: clamp(1.463rem, -0.011vw + 1.49rem, 1.488rem);
		}

		h1 {
			font-size: clamp(1.5rem, 0.661vw + 1.347rem, 3rem);
			line-height: clamp(2.55rem, 0.595vw + 2.412rem, 3.9rem);
		}

		h3 {
			font-size: clamp(1.25rem, 0.496vw + 1.135rem, 2.375rem);
			line-height: clamp(2.125rem, 0.424vw + 2.027rem, 3.088rem);
			margin-top: 1em;
		}

		h4 {
			font-size: clamp(1.188rem, 0.413vw + 1.092rem, 2.125rem);
			line-height: clamp(2.019rem, 0.328vw + 1.943rem, 2.763rem);
			margin-top: 2em;
		}

		h5,
		summary {
			font-size: clamp(1.125rem, 0.331vw + 1.049rem, 1.875rem);
			line-height: clamp(1.912rem, 0.231vw + 1.859rem, 2.438rem);
			margin-top: 1em;
		}

		.hidden {
			display: none;
		}

		.advanced {
			display: none;
		}

		h1,
		h2,
		h3,
		h4,
		h5,
		h6,
		summary {
			font-family: "Marcellus SC", serif;
			font-weight: 600;
		}

		/* Other Styling */
		body {
			background-color: black;
			color: white;
			-webkit-font-smoothing: antialiased;
			margin: 5%;
			margin-top: 1em;
		}

		#result {
			max-width: 1200px;
		}

		#footer {
			margin-top: 1em;
			max-width: 1200px;
		}

		ol,
		ul {
			margin-top: 1em;
			margin-bottom: 2em;
			margin-left: 2%;
			margin-right: 2%;
		}

		li {
			margin-bottom: 1em;
		}

		li li,
		details li {
			margin-bottom: 0.33em;
		}

		ol ol,
		ol ul,
		ul ol,
		ul ul {
			margin-top: 1em;
			margin-bottom: 1em;
			margin-left: 2%;
			margin-right: 0;
		}

		a {
			color: #89CFF0;
			/* Blue color for links */
		}

		b,
		strong {
			color: #e08821;
			/* Nolvus orange color for bold text */
		}

		code {
			color: #f0c491;
			margin-left: 0;
			padding-left: 0;
		}

		button,
		textarea {
			color: black;
			padding: 0.2em 0.4em;
			/* Padding relative to the font size */
			border: none;
			border-radius: 0.2em;
			/* Border radius relative to the font size */
		}

		textarea {
			width: 100%;
			margin: 0.2em;
			margin-left: 0;
			box-sizing: border-box;
			/* Include padding and border in the element's width */
			padding: 0.5em;
			border: 1px solid #ccc;
			resize: both;
		}

		button {
			display: inline-block;
			margin-right: 1em;
			/* Adjust the spacing between buttons */
		}

		#crashLog.dragover {
			background-color: #d0d0d0;
			/* Light grey background when dragging over */
		}

		.extraInfo {
			list-style-type: none;
			margin-left: 2%;
		}

		.extraInfo li {
			list-style-type: disc;
		}
	</style>


	<script>

		function hasNolvusUltra(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// List of plugins to check
			const plugins = [
				//FOUND IN REDUX: 'blubbopines_v3.esp',
				'treerific.esp',
				'dawn of skyrim.esp',
				'moretreesincities.esp'
			];
			// Check if crashLog includes any of the plugins
			for (let plugin of plugins) {
				if (crashLog.includes(plugin)) {
					return true;
				}
			}
			return false;
		}

		function reduxOrUltraVariant(crashLog) {
			if (countPlugins(crashLog) > 2100) { //NOTE: probably can't reliably determine if less than 2100 plugins ... all of them might not have loaded?
				if (hasNolvusUltra(crashLog)) {
					return 'Ultra';
				} else {
					return 'Redux';
				}
			} else {
				return '???';
			}
		}

		function hasPhysics(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// List of physics-related plugins to check
			const physicsPlugins = [
				'kshairdosSMP.esp',
				'ursine armour hdt smp se.esp',
				'1nivwiccloaks_smp_patch.esp',
				'cloaks&capes_smp_patch.esp',
				'cloaks_smp_patch.esp'
			];
			// Check if crashLog includes any of the physics plugins
			for (let plugin of physicsPlugins) {
				if (crashLog.includes(plugin)) {
					return true;
				}
			}
			return false;
		}

		function hasAlternateLeveling(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// List of Alternate Leveling plugins to check
			const alternateLevelingPlugins = [
				'experience.esl',
				'experience.esp',
				'staticskillleveling.esp'
			];
			// Check if crashLog includes any of the Alternate Leveling plugins
			for (let plugin of alternateLevelingPlugins) {
				if (crashLog.includes(plugin)) {
					return true;
				}
			}
			return false;
		}

		function hasHardcoreMode(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// List of Hardcore Mode plugins to check
			const hardcoreModePlugins = [
				'skyrim revamped.esp',
				'the_sinister_seven.esp',
				'realistic ai detection 3 - lite.esp'
			];
			// Check if crashLog includes any of the Hardcore Mode plugins
			for (let plugin of hardcoreModePlugins) {
				if (crashLog.includes(plugin)) {
					return true;
				}
			}
			return false;
		}
		function hasFantasyMode(crashLog) {
			crashLog = crashLog.toLowerCase();
			if (crashLog.includes('doublejump.esp')) {
				return true;
			}
			return false;
		} 

		function hasSseFpsStabilizer(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// Check if crashLog includes ssefpsstabilizer.dll
			if (crashLog.includes('ssefpsstabilizer.dll')) {
				return true;
			}
			return false;
		}

		function hasPaidUpscaler(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// Check if crashLog includes indicators
			if (crashLog.includes('ffx_fsr2_api_x64.dll') || crashLog.includes('nvngx_dlssg.dll') || crashLog.includes('libxess.dll')) {
				return true;
			}
			return false;
		}

		function hasFSR3(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// Check if crashLog includes indicators
			if (crashLog.includes('nvngx_dlssg.dll')) {
				return true;
			}
			return false;
		}

		function countNullVoid(crashLog) {
			// Convert crashLog to lower case
			crashLog = crashLog.toLowerCase();
			// Count the number of times "null" or "void" appears in the crashLog
			const nullCount = (crashLog.match(/null/g) || []).length;
			const voidCount = (crashLog.match(/void/g) || []).length;
			return nullCount + voidCount;
		}

		function countPlugins(crashLog) {
			const gamePluginsCountRegex = /Game plugins \((\d+)\)\s*\{([\s\S]*?)}/;
			var gamePluginsCountMatch = crashLog.match(gamePluginsCountRegex);
			var gamePluginsCountSection = gamePluginsCountMatch ? gamePluginsCountMatch[1] : '0';
			const gamePluginsCount = parseInt(gamePluginsCountSection);
			 //DEBUGGING: console.log('gamePluginsCountMatch:', gamePluginsCountMatch);
			 //DEBUGGING: console.log('gamePluginsCount:', gamePluginsCount);
			return gamePluginsCount;
		}
		


		function getNonNolvusGamePlugins(crashLog) {
			return fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusPlugins - Alphabetized.txt')
			.then(response => response.text())
			.then(data => {
				const vanillaNolvusPluginsLines = data.split('\n').map(line => line.trim());

				const gamePluginsRegex = /Game plugins \(\d+\)\s*\{([\s\S]*?)}/;
				var gamePluginsMatch = crashLog.match(gamePluginsRegex);
				var gamePluginsSection = gamePluginsMatch ? gamePluginsMatch[1] : '';

				const gamePluginsLines = gamePluginsSection.split('\n');

				const nonVanillaPlugins = [];

				gamePluginsLines.forEach(line => {
					if (line.includes(']')) {
						const pluginName = line.substring(line.indexOf(']') + 1).trim();
						if (!vanillaNolvusPluginsLines.includes(pluginName.toLowerCase())) {
							nonVanillaPlugins.push(pluginName);
						}
					}
				});

				nonVanillaPlugins.sort();

				return nonVanillaPlugins;
			})
			.catch(error => console.error(error));
		}

		function getMissingVanillaPlugins(crashLog) {
			return fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusPlugins - Alphabetized.txt')
				.then(response => response.text())
				.then(data => {
					const vanillaNolvusPluginsLines = data.split('\n').map(line => line.trim().toLowerCase());

					const gamePluginsRegex = /Game plugins \(\d+\)\s*\{([\s\S]*?)}/;
					var gamePluginsMatch = crashLog.match(gamePluginsRegex);
					var gamePluginsSection = gamePluginsMatch ? gamePluginsMatch[1] : '';

					const gamePluginsLines = gamePluginsSection.split('\n').map(line => {
						if (line.includes(']')) {
							return line.substring(line.indexOf(']') + 1).trim().toLowerCase();
						}
						return null;
					}).filter(Boolean);

					const missingVanillaPlugins = vanillaNolvusPluginsLines.filter(plugin => !gamePluginsLines.includes(plugin));

					return missingVanillaPlugins;
				})
				.catch(error => console.error(error));
		}

		function getNonNolvusModules(crashLog) {
			return fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusModules.txt')
			.then(response => response.text())
			.then(data => {
				const vanillaNolvusModulesLines = data.split('\n').map(line => line.trim());

				const modulesRegex = /Modules\s*\{([\s\S]*?)}/;
				var modulesMatch = crashLog.match(modulesRegex);
				var modulesSection = modulesMatch ? modulesMatch[1] : '';

				const modulesLines = modulesSection.split('\n');

				const nonVanillaModules = [];

				modulesLines.forEach(line => {
					if (line.includes(':')) {
						const moduleName = line.substring(0, line.indexOf(':')).trim();
						if (!vanillaNolvusModulesLines.includes(moduleName.toLowerCase())) {
							nonVanillaModules.push(moduleName);
						}
					}
				});

				nonVanillaModules.sort();

				return nonVanillaModules;
			})
			.catch(error => console.error(error));
		}

		function getBadlyOrganizedNolvusPlugins(crashLog) {
			return fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusPlugin-WithStableLocation.txt')
				.then(response => response.text())
				.then(data => {
					const vanillaNolvusPlugins = data.split('\n').map(line => line.trim().toLowerCase());

					const gamePluginsRegex = /Game plugins \(\d+\)\s*\{([\s\S]*?)}/;
					var gamePluginsMatch = crashLog.match(gamePluginsRegex);
					var gamePluginsSection = gamePluginsMatch ? gamePluginsMatch[1] : '';

					const pluginsInCrashLog = gamePluginsSection.split('\n');

					const vanillaPluginsInCrashLog = [];
					pluginsInCrashLog.forEach((line, index) => {
						if (line.includes(']')) {
							const pluginName = line.substring(line.indexOf(']') + 1).trim();
							if (vanillaNolvusPlugins.includes(pluginName.toLowerCase())) {
								vanillaPluginsInCrashLog.push(pluginName);
							}
						}
					});

					const badlyOrderedVanillaPluginsInCrashLog = [];
					vanillaPluginsInCrashLog.forEach((line, index) => {
						let pluginVanillaIndex = vanillaNolvusPlugins.indexOf(line.toLowerCase());
						let nextPluginInCrashLog = vanillaPluginsInCrashLog[index + 1];
						
						if (nextPluginInCrashLog) {
							let nextPluginVanillaIndex = vanillaNolvusPlugins.indexOf(nextPluginInCrashLog.toLowerCase());

							if (nextPluginVanillaIndex < pluginVanillaIndex) {
								badlyOrderedVanillaPluginsInCrashLog.push(line);
							}
						}
					});

					return badlyOrderedVanillaPluginsInCrashLog;
				})
				.catch(error => console.error(error));
		}

		function getNonNolvusGamePluginsBelowSynthesis(crashLog) {
			return fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusPlugins - Alphabetized.txt')
			.then(response => response.text())
			.then(data => {
				const vanillaNolvusPluginsLines = data.split('\n').map(line => line.trim());
				const gamePluginsRegex = /Game plugins \(\d+\)\s*\{([\s\S]*?)}/;
				var gamePluginsMatch = crashLog.match(gamePluginsRegex);
				var gamePluginsSection = gamePluginsMatch ? gamePluginsMatch[1] : '';
				const gamePluginsLines = gamePluginsSection.split('\n');
				const nonVanillaPluginsAtBottom = [];
				let isBelowSynthesis = false;
				gamePluginsLines.forEach(line => {
					if (line.includes(']')) {
						const pluginName = line.substring(line.indexOf(']') + 1).trim();
						if (pluginName.toLowerCase() === 'synthesis.esp') {
							isBelowSynthesis = true;
						}
						if (isBelowSynthesis && !vanillaNolvusPluginsLines.includes(pluginName.toLowerCase())) {
							nonVanillaPluginsAtBottom.push(pluginName);
						}
					}
				});
				//DISABLED: nonVanillaPlugins.sort();
				console.log('nonVanillaPluginsAtBottom:', nonVanillaPluginsAtBottom);
				return nonVanillaPluginsAtBottom;
			})
			.catch(error => console.error(error));
		}

		function compareLogToVanillaNolvusPluginsLines(crashLog) {
			Promise.all([
				fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusPlugins.txt'),
				fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/nonVanillaPlugins.txt')
			])
			.then(responses => Promise.all(responses.map(response => response.text())))
			.then(data => {
				// Split the text into lines and trim and convert each line to lower case
				const vanillaNolvusPlugins = data[0].split('\n').map(line => line.trim());
				const nonVanillaPlugins = data[1].split('\n').map(line => line.trim().toLowerCase());

				// Extract the "Possible relevant objects" section
				const gamePluginsRegex = /Game plugins \(\d+\)\s*\{([\s\S]*?)}/;
				var gamePluginsMatch = crashLog.match(gamePluginsRegex);
				var gamePluginsSection = gamePluginsMatch ? gamePluginsMatch[1] : '';

				// Split the gamePluginsSection into an array of lines
				const pluginsInCrashLog = gamePluginsSection.split('\n');

				// Create an array to store the non-vanilla plugins
				const vanillaPluginsInCrashLog = [];
				const nonVanillaPluginsInCrashLog = [];
				const allPluginsInCrashLog = [];
				const possibleReduxPluginInCrashLog = [];
				const missingPluginsInCrashLog = [];
				
				pluginsInCrashLog.forEach((line, index) => {
					if (line.includes(']')) {
						const pluginName = line.substring(line.indexOf(']') + 1).trim().toLowerCase();
						
						allPluginsInCrashLog.push(pluginName); //TEMPORARY:

						if (vanillaNolvusPlugins.includes(pluginName)) {
							vanillaPluginsInCrashLog.push(pluginName);
						} else {
							nonVanillaPluginsInCrashLog.push(pluginName);
						}
					} else {
						// Handle the case where the line does not contain ']'
						missingPluginsInCrashLog.push(line);
						// Skip presuming it is an empty line ... probably the { or } line
						//DEBUGGING: console.error('A line does not contain a plugin name:', line);
					}
				});

				const badlyOrderedVanillaPluginsInCrashLog = [];
				vanillaPluginsInCrashLog.forEach((line, index) => {
					let pluginVanillaIndex = vanillaNolvusPlugins.indexOf(line);
					let nextPluginInCrashLog = vanillaPluginsInCrashLog[index + 1];
					let nextPluginVanillaIndex = vanillaNolvusPlugins.indexOf(nextPluginInCrashLog);

					if (nextPluginInCrashLog && (nextPluginVanillaIndex < pluginVanillaIndex)) {
						badlyOrderedVanillaPluginsInCrashLog.push(line);
					}
				});

				// Alphabetize the nonVanillaPlugins array
				//DEPENDS: nonVanillaPlugins.sort();

				// Convert the nonVanillaPlugins array to a string with new lines for every plugin
				const nonVanillaPluginsInCrashLogString = nonVanillaPluginsInCrashLog.join('\n');
				const allPluginsInCrashLogString = allPluginsInCrashLog.join('\n');

				// Log the nonVanillaPlugins string along with the count
				console.log(`Possibly non-vanilla plugins (${nonVanillaPluginsInCrashLog.length}):\n${nonVanillaPluginsInCrashLogString}`);
				//console.log(`All plugins (${allPluginsInCrashLog.length}):\n${allPluginsInCrashLogString}`);
				
				// Log the nonVanillaPlugins string along with the count
				console.log('possibleReduxPluginInCrashLog:', possibleReduxPluginInCrashLog);

				// Log the badlyOrderedVanillaPlugins
				console.log('Badly ordered vanilla plugins:', badlyOrderedVanillaPluginsInCrashLog);
				console.log('Presumably-empty lines in crash log:', missingPluginsInCrashLog);
				
			})
			.catch(error => console.error(error));
		}

		function compareLogToVanillaNolvusModulesLines(crashLog) {
			return fetch('https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/vanillaNolvusModules.txt')
			.then(response => response.text())
			.then(data => {
				const vanillaNolvusModulesLines = data.split('\n').map(line => line.trim());

				// Extract the "Possible relevant objects" section
				const modulesRegex = /Modules\s*\{([\s\S]*?)}/;
				var modulesMatch = crashLog.match(modulesRegex);
				var modulesSection = modulesMatch ? modulesMatch[1] : '';

				// Split the modulesSection into lines
				const modulesLines = modulesSection.split('\n');

				// Create an array to store the non-vanilla Modules
				const nonVanillaModules = [];
				// const badlyOrderedVanillaModules = [];
				const possibleReduxFlags = [];

				// Loop through each line in modulesSection
				modulesLines.forEach((line, index) => {
					// Check if the line contains ':'
					if (line.includes(':')) {
						// Split the line by ':' and take the first part, trim it and convert it to lower case
						const moduleName = line.substring(0, line.indexOf(':')).trim().toLowerCase();

						// If the moduleName is not found in vanillaNolvusModulesLines, add it to the nonVanillaModules array
						if (!vanillaNolvusModulesLines.includes(moduleName)) {
							nonVanillaModules.push(moduleName);
						}
						//  else {
						// 	// Check if the next item in vanillaNolvusModulesLines isn't also after in modulesLines
						// 	const nextVanillaModule = vanillaNolvusModulesLines[vanillaNolvusModulesLines.indexOf(moduleName) + 1];
						// 	if (nextVanillaModule && !modulesLines.slice(index + 1).some(line => line.toLowerCase().includes(nextVanillaModule))) {
						// 		badlyOrderedVanillaModules.push(moduleName);
						// 	}
						// }
					} else {
						// Handle the case where the line does not contain ':'
						console.error('A line does not contain a module name:', line);
					}
				});

				// Alphabetize the nonVanillaModules array
				//LATER: nonVanillaModules.sort();

				// Convert the nonVanillaModules array to a string with new lines for every module
				const nonVanillaModulesString = nonVanillaModules.join('\n');

				// Log the nonVanillaModules string along with the count
				console.log(`Possibly non-vanilla modules (${nonVanillaModules.length}):\n${nonVanillaModulesString}`);

				// Log the nonVanillaModules string along with the count
				console.log('possibleReduxFlags:', possibleReduxFlags);

				// Log the badlyOrderedVanillaModules
				//console.log('badlyOrderedVanillaModules:', badlyOrderedVanillaModules);
			})
			.catch(error => console.error(error));
		}


		function getPercentAlphabetized(passedLogFile) {
			// Extract the "Game plugins" section
			const pluginsRegex = /Game plugins \(\d+\)\s*\{[\s\S]*?\}/;
			var pluginsMatch = passedLogFile.match(pluginsRegex);
			var pluginsSection = pluginsMatch ? pluginsMatch[0] : '';

			// Split the section into lines and filter out non-.esp plugin lines
			var lines = pluginsSection.split('\n').filter(line => line.includes('.esp'));

			// Variables to count alphabetization issues
			var alphabetizedOrderCount = 0;
			var totalEspPlugins = lines.length - 1; // Subtract one because we compare each plugin to the next

			// Check if each .esp plugin is alphabetically ordered
			for (var i = 0; i < totalEspPlugins; i++) {
				// Extract plugin names without the bracketed index
				var currentPluginMatch = lines[i].match(/^\s*\[.*?\]\s*(.+\.esp)$/i);
				var nextPluginMatch = lines[i + 1].match(/^\s*\[.*?\]\s*(.+\.esp)$/i);

				if (currentPluginMatch && nextPluginMatch) {
					var currentPlugin = currentPluginMatch[1].toLowerCase().trim();
					var nextPlugin = nextPluginMatch[1].toLowerCase().trim();
					// Compare plugin names and count if alphabetized
					if (currentPlugin.localeCompare(nextPlugin) < 0) {
						alphabetizedOrderCount++;
						//DEBUGGING: console.log(currentPlugin + ' is alphabetized before ' + nextPlugin); //DEBUGGING
					}
				} else {
					// Handle the case where the line does not contain a .esp file name
					console.error('A line does not contain a .esp file name:', lines[i]); //DEBUGGING
				}
			}
			// Calculate the percentage of alphabetized .esp plugins
			var percentAlphabetized = (alphabetizedOrderCount / totalEspPlugins) * 100;
			//DEBUGGING console.log('percentAlphabetized:',percentAlphabetized); //DEBUGGING
			return percentAlphabetized.toFixed(2); // Return percentage rounded to two decimals
		}

		function extractNifPathsToListItems(logText) {
			const regex = /"([^"]+\.nif)"/g;
			let match;
			const pathsSet = new Set();

			while ((match = regex.exec(logText)) !== null) {
				pathsSet.add(match[1]);
			}

			// If no matches were found, add the no meshes found message to the set
			if (pathsSet.size === 0) {
				pathsSet.add('(no meshes found in crash log ... consider decompressing relevant .bsa archives)');
			}

			// Convert the Set back to an array and process to list items
			return processListItems([...pathsSet]);
		}

		function extractSkyrimTexturePathsToListItems(logText) {
			const regex = /"([^"]+\.(dds|tga|bmp))"/g;
			let match;
			const pathsSet = new Set();

			while ((match = regex.exec(logText)) !== null) {
				pathsSet.add(match[1]);
			}

			// If no matches were found, add the no textures found message to the set
			if (pathsSet.size === 0) {
				pathsSet.add('(no textures found in crash log ... consider decompressing relevant .bsa archives)');
			}

			// Convert the Set back to an array and process to list items
			return processListItems([...pathsSet]);
		}

		function processListItems(listItems) {
			// Deduplicate the list before truncating
			const dedupedListItemsBeforeTruncate = [...new Set(listItems)];

			// Truncate each file name if over 300 characters
			const truncatedListItems = dedupedListItemsBeforeTruncate.map(itemName => {
				if (itemName.length > 300) {
					itemName = itemName.substring(0, 300) + '...';
				}
				return itemName;
			});

			// Deduplicate the list after truncating
			const dedupedListItemsAfterTruncate = [...new Set(truncatedListItems)];

			// Wrap each file name in HTML
			const wrappedListItems = dedupedListItemsAfterTruncate.map(itemName => {
				return '<li><code>' + itemName + '</code></li>';
			});

			// Add <ul> tags before the first <li> and after the last <li>
			return wrappedListItems.join('');
		}

		// Define the explainers list
			const explainersMap = new Map([
				['_nvngx.dll', '(<b>NVIDIA</b> NGX Runtime Library)'],
				['a0d789patch.dll', '(<b>recommended</b> bug fix)'],
				['amdxc64.dll', '(<b>AMD</b> component)'],
				['antimalware_provider64.dll', '(<b>Antimalware</b> Provider)'],
				['applicationtargetedfeaturedatabase.dll', '(Feature Database) - MS <b>Windows</b>'],
				['asm.plugin.audiodevprops2.dll', '(<b>Nahimic</b> audio component)'],
				['atcuf64.dll', '(<b>Bitdefender</b> Active Threat Control Userland API)'],
				['atiuxp64.dll', '(<b>AMD</b> graphics component)'],
				['atiumd6a.dll', '(<b>AMD</b> graphics component)'],
				['autohdr64.addon', '(AutoHDR Addon for <b>ReShade</b>)'],
				['avamsi.dll', '(Avira <b>Antimalware</b> Scan Interface)'],
				['avamsicli.dll', '(Avira <b>Antimalware</b> Client Interface)'],
				['backportedeslsupport.dll', '(aka BEES)'],
				['bdhkm64.dll', '(<b>Bitdefender</b> Hooking Module)'],
				['cbp.dll', '(Collision Body <b>Physics</b>)'],
				['ccbgssse018-shadowrend.esl', '(Refer to <b>diagnosis</b>)'],
				['com_antivirus.dll', '(Kaspersky Com<b>Antivirus</b> Component)'],
				['comctl32.dll', '(Common Controls Library) - MS <b>Windows</b>'],
				['concrt140.dll', '(Concurrency Runtime Library) - MS <b>Windows</b>'],
				['comdlg32.dll', '(Common Dialog Box Library) - MS <b>Windows</b>'],
				['compstui.dll', '(Common Property Sheet User Interface) - MS <b>Windows</b> printing component'],
				['d3d10.dll', '(Direct3D 10 Runtime) - MS <b>Windows</b> graphics component'],
				['d3d10_1.dll', '(Direct3D 10.1 Runtime) - MS <b>Windows</b> graphics component'],
				['d3d10_1core.dll', '(Direct3D 10.1 Core Runtime) - MS <b>Windows</b> graphics component'],
				['d3d10core.dll', '(Direct3D 10 Core Runtime) - MS <b>Windows</b> graphics component'],
				['d3d11.dll', '(Direct3D 11 Runtime) - MS <b>Windows</b> graphics component'],
				['d3d11on12.dll', '(Direct3D 11On12 Runtime) - MS <b>Windows</b> graphics component'],
				['d3d12core.dll', '(Direct3D 12 Core Runtime) - MS <b>Windows</b> graphics component'],
				['d3dcompiler_42.dll', '(DirectX HLSL Compiler) - MS <b>Windows</b> graphics component'],
				['d3dscache.dll', '(Direct3D Shader Cache) - MS <b>Windows</b> graphics component'],
				['d3dx9_43.dll', '(Direct3D 9 Extensions) - MS <b>Windows</b> graphics component'],
				['d3dx10_42.dll', '(DirectX 10.1 Extensions) - MS <b>Windows</b> graphics component'],
				['d3dx11_42.dll', '(Direct3D 11 Extensions) - MS <b>Windows</b> graphics component'],
				['detoured.dll', '(<b>Microsoft</b> Detours Library)'],
				['deviceaccess.dll', '(Device Broker And Policy COM Server) - MS <b>Windows</b>'],
				['discordhook64.dll', '(Discord In-Game <b>Overlay</b> Library)'],
				['dkaf.dll', '(Skyrim</b> modding tool for <b>binding keys to actions/animations</b>)'],
				['dmenu.dll', '(Dynamic Menu for Skyrim SE Mods) - MS <b>Windows</b>'],
				['dxcompiler.dll', '(Direct3D Shader Compiler) - MS <b>Windows</b>'],
				['dxgi.dll', '(DirectX Graphics Infrastructure) - MS <b>Windows</b>'],
				['dxil.dll', '(DirectX Intermediate Language Library) - MS <b>Windows</b>'],
				['dxilconv.dll', '(DXBC to DXIL Converter) - MS <b>Windows</b>'],
				['eamsi.dll', '(ESET <b>Antimalware</b> Scan Interface)'],
				['edputil.dll', '(EDP Utility Library) - MS <b>Windows</b>'],
				['ffx_backend_dx12_x64.dll', '(FidelityFX S.R. 3.0 Backend Library) - <b>NVIDIA</b>'],
				['ffx_frameinterpolation_x64.dll', '(FidelityFX S.R. 3.0 Frame Interpolation) - <b>NVIDIA</b>'],
				['ffx_fsr2_api_dx11_x64.dll', '(FidelityFX S.R. 2 API for DirectX 11) - <b>AMD</b>'],
				['ffx_fsr2_api_dx12_x64.dll', '(FidelityFX S.R. 2.0 API for DirectX 12) - <b>AMD</b>'],
				['ffx_fsr2_api_x64.dll', '(FidelityFX S.R. 2 API) - <b>AMD</b>'],
				['ffx_fsr3_x64.dll', '(FidelityFX S.R. 3.0 Core Library) - <b>NVIDIA</b> driver'],
				['ffx_fsr3upscaler_x64.dll', '(FidelityFX S.R. 3.0 <b>Upscaler</b>) - <b>NVIDIA</b>'],
				['ffx_opticalflow_x64.dll', '(Optical Flow for FidelityFX S.R. 3.0) - <b>NVIDIA</b>'],
				['fwmf.esp', '(Flat World <b>Map</b> Framework)'],
				['gameoverlayrenderer64.dll', '(Steam <b>Overlay</b>)'],
				['glu32.dll', '(OpenGL Utility Library) - <b>graphics</b> component'],
				['hdtsmp64.dll', '(Skinned Mesh <b>Physics</b>)'],
				['igc64.dll', '(<b>Intel</b> Graphics Compiler for OpenCL)'],
				['igd10iumd64.dll', '(<b>Intel</b> Graphics Accelerator Drivers)'],
				['igd10um64gen11.dll', '(<b>Intel</b> Graphics Accelerator Driver)'],
				['igd10um64xe.dll','(<b>Intel</b> HD Graphics Driver)'],
				['igdgmm64.dll', '(<b>Intel</b> HD Graphics Drivers)'],
				['intelcontrollib.dll', '(<b>Intel</b> Graphics Control Lib Runtime)'],
				['jsproxy.dll', '(JScript Proxy Auto-Configuration) - associated with <b>Internet Explorer</b>'],
				['kerberos.dll', '(Kerberos Security Package) - MS <b>Windows</b> security component'],
				['libxess.dll', '(Xe Super Sampling Library) - <b>NVIDIA</b>'],
				['markarth outskirts - water for enb (shades of skyrim) patch.esp','(optionally load after <b>DynDOLOD.esp</b>)'],
				['medal-hook64.dll', '(<b>Medal.tv</b> Hook Library) - used for game recording and streaming features'],
				['mlang.dll', '(Multilanguage Support DLL) - MS <b>Windows</b>'],
				['msacm32.dll', '(<b>Microsoft</b> ACM Audio Filter)'],
				['msiso.dll', '(Internet Explorer Isolation Library) - MS <b>Windows</b>'],
				['msvcp110_win.dll', '(<b>Microsoft</b> STL110 C++ Runtime Library)'],
				['n64hooks.dll', '(<b>N64</b> hooks library)'],
				['ninput.dll', '(<b>Microsoft</b> Pen and Touch Input Component)'],
				['nscore64.dll', '(<b>Nscore</b> library)'],
				['nvapi64.dll', '(<b>NVIDIA</b> Driver API Library)'],
				['nvcuda.dll', '(<b>NVIDIA</b> CUDA Driver)'],
				['nvlddmkm.sys', '(<b>NVIDIA</b> Windows Kernel Mode Driver)'],
				['nvngx_dlss.dll', '(<b>NVIDIA</b> DLSS Driver)'],
				['nvngx_dlssg.dll', '(<b>NVIDIA</b> DLSS Driver for FSR3)'],
				['nvofapi64.dll', '(<b>NVIDIA</b> Optical Flow API)'],
				['nvoglv32.dll', '(<b>NVIDIA</b> OpenGL Driver for 32-bit)'],
				['nvoglv64.dll', '(<b>NVIDIA</b> OpenGL Driver for 64-bit)'],
				['nvwgf2um.dll', '(<b>NVIDIA</b> D3D10 User Mode Driver for 32-bit)'],
				['nvwgf2umx.dll', '(<b>NVIDIA</b> D3D10 User Mode Driver for 64-bit)'],
				['oleacc.dll', '(Active Accessibility Core Component) - MS <b>Windows</b>'],
				['onecorecommonproxystub.dll', '(<b>Windows</b> system component)'],
				['onecoreuapcommonproxystub.dll', '(OneCore UAP Common Proxy Stub) - MS <b>Windows</b>'],
				['openanimationreplacer.dll', '(aka OAR)'],
				['opengl32.dll', '(OpenGL Client DLL) - <b>graphics</b> component'],
				['ow-graphics-hook64.dll', '(<b>Overwolf</b> Graphics Hook gaming component)'],
				['owclient.dll', '(<b>Overwolf</b> gaming component)'],
				['owexplorer.dll', '(<b>Overwolf</b> gaming component)'],
				['owutils.dll', '(<b>Overwolf</b> gaming component)'],
				['papyrusextender64.dll', '(Papyrus <b>Script</b> Extender)'],
				['papyrusextenderse.dll', '(Papyrus <b>Script</b> Extender)'],
				['papyrusextenderse64.dll', '(Papyrus <b>Script</b> Extender)'],
				['papyrustweaks.dll', '(Papyrus <b>Script</b> Tweaks)'],
				['papyrusutil.dll', '(Papyrus <b>Script</b> Utility)'],
				['pdperfplugin.dll', '(<b>Puredark\'s</b> Performance Plugin)'],
				['po3_papyrusextender.dll', '(Papyrus <b>Script</b> Extender)'],
				['product_info.dll', '(A-Volute 3D Sound Experts) - <b>audio</b> component'],
				['rtsshooks64.dll', '(RivaTuner Statistics Server Hooks for graphics card <b>monitoring</b>)'],
				['skee64.dll', '(Skyrim <b>Script</b> Extender)'],
				['skse64_1_5_97.dll', '(Skyrim <b>Script</b> Extender)'],
				['skyrimautoreloader.dll', '(<b>recommended</b> bug fix)'],
				['skyrim paper map by freelancecartography (2nd edition) for fwmf.esp', '(place near <b>bottom</b>)'],
				['skyrimupscaler.dll', '(<b>Puredark\'s Upscaler</b>)'],
				['sl.common.dll', '(Streamline Common Library) - <b>NVIDIA</b>'],
				['sl.dlss_g.dll', '(<b>NVIDIA</b> DLSS Frame Generation)'],
				['sl.interposer.dll', '(<b>NVIDIA</b> Streamline Interposer Module)'],
				['sl.reflex.dll', '(<b>NVIDIA</b> Reflex Library)'],
				['symamsi.dll', '(<b>Antivirus</b> and Internet Security)'],
				['symsrv.dll', '(Symbol Server) - MS <b>Windows</b> debugging component'],
				['tbbmalloc.dll', '(Threading Building Blocks Memory Allocator) - <b>Intel</b>'],
				['threadpoolwinrt.dll', '(<b>Windows</b> Runtime Thread Pool Library)'],
				['uiautomationcore.dll', '(<b>Microsoft</b> UI Automation Core)'],
				['usvfs_x64.dll', '(User Space Virtual File System) - <b>MO2</b>'],
				['vcruntime140.dll', '(Visual C++ Runtime Library) - MS <b>Windows</b>'],
				['vulkan-1.dll', '(Vulkan Runtime Library) - MS <b>Windows</b>'],
				['vulkaninfo.exe', '(Vulkan Info Utility) - MS <b>Windows</b>'],
				['water for enb (shades of skyrim).esp', '(optionally load after <b>DynDOLOD.esp</b> along with patches)'],
				['water for enb - patch - atlas map markers.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - beyond reach.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - beyond skyrim.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - blue rift water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - blue volcanic water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - clear creek water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - clear interior water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - clear underwater.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - darker lod water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - expanded towns and cities.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - folkvangr.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - fwmf for fantasy paper maps.esp', '(Load after <b>FWMF for Fantasy Paper Maps.esp</b>)'],
				['water for enb - patch - generic landscape patch.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - jks bannered mare.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - jks ragged flagon.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - landscape fixes for grass mods.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - lux - jks ragged flagon.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - muddy creek water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - transparent horse trough water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - volcanic water.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['water for enb - patch - wyrmstooth.esp', '(optionally load after <b>DynDOLOD.esp</b>)'],
				['windows.shell.servicehostbuilder.dll', '(<b>Windows</b> Shell Service Host Builder)'],
				['windows.staterepositorycore.dll', '(<b>Windows</b> State Repository Core)'],
				['windows.system.launcher.dll', '(<b>Windows</b> System Launcher)'],
				['winepulse.drv', '(Wine PulseAudio Driver) - Windows <b>emulator</b>'],
				['winevulkan.dll', '(Wine Vulkan Driver) - Windows <b>emulator</b>'],
				['winex11.drv', '(Wine X11 Driver) - Windows <b>emulator</b>'],
				['winspool.drv', '(<b>Windows</b> Spooler Driver) - printing subsystem'],
				['wtsapi32.dll', '(<b>Windows</b> Terminal Server SDK API)'],
				['xefx.dll', '(<b>Intel</b> Xe Graphics Architecture)'],
				['xefx_loader.dll', '(<b>Intel</b> Xe Graphics Loader)'],
			]);


		function replaceWithExplainers(fileList) {
			// Append the explanations to the items in fileList
			for (let i = 0; i < fileList.length; i++) {
				let lowerCaseFile = fileList[i].toLowerCase();
				if (explainersMap.has(lowerCaseFile)) {
					fileList[i] += ' ' + explainersMap.get(lowerCaseFile);
				}
			}

			return fileList;
		}


		// - - - Main Function - - - 
		async function analyzeLog() {
			clearResult();
			var logFile = document.getElementById('crashLog').value;
			var diagnoses = '';
			var diagnosesCount = 0;

			//DISABLE UNLESS NEEDED: compareLogToVanillaNolvusPluginsLines(logFile);	
			//DISABLE UNLESS NEEDED: compareLogToVanillaNolvusModulesLines(logFile);	
			
			var logsFirstLine = logFile.split('\n')[0];

			//Extract the entire top part of the crash log (excluding "Modules", "Plugins", and "Game plugins" sections)
			const logsTopHalfRegex = /^([\s\S]*?Stack\s*{[\s\S]*?})/;
			var logsTopHalfMatch = logFile.match(logsTopHalfRegex);
			var logsTopHalf = logsTopHalfMatch ? logsTopHalfMatch[0] : '';
			//DEBUGGING: console.log('logsTopHalf:' + logsTopHalf);

			//logsTopThird contains heading, "Possible relevant objects", "Probable callstack", and "Registers" (but excludes the full "Stack")
			const logsTopThirdRegex = /^([\s\S]*?Registers\s*{[\s\S]*?})/;
			var logsTopThirdMatch = logsTopHalf.match(logsTopThirdRegex);
			var logsTopThird = logsTopThirdMatch ? logsTopThirdMatch[0] : '';
			//DEBUGGING: console.log('logsTopThird:' + logsTopThird);

			//logsTopThirdNoHeading contains "Possible relevant objects", "Probable callstack", and "Registers"
			const logsTopThirdNoHeadingRegex = /(Possible relevant objects[\s\S]*)/;
			var logsTopThirdNoHeadingMatch = logsTopThird.match(logsTopThirdNoHeadingRegex);
			var logsTopThirdNoHeading = logsTopThirdNoHeadingMatch ? logsTopThirdNoHeadingMatch[0] : '';
			//DEBUGGING:console.log('logsTopThirdNoHeading:' + logsTopThirdNoHeading);  

			// Extract the "Possible relevant objects" section
			const relevantObjectsRegex = /Possible relevant objects \(\d+\)\s*\{[\s\S]*?\}/;
			var relevantObjectsMatch = logsTopThird.match(relevantObjectsRegex);
			var relevantObjectsSection = relevantObjectsMatch ? relevantObjectsMatch[0] : '';
			//DEBUGGING: console.log('relevantObjectsSection:' + relevantObjectsSection);

			// Extract the "Probable callstack" section
			const probableCallstackRegex = /Probable callstack\s*\{[\s\S]*?\}/;
			var probableCallstackMatch = logsTopThird.match(probableCallstackRegex);
			var probableCallstackSection = probableCallstackMatch ? probableCallstackMatch[0] : '';
			//DEBUGGING: console.log('probableCallstackSection:' + probableCallstackSection);


			// Check for proper log file
			if (!logsTopThird.includes('NetScriptFramework')) {
				diagnoses += '<li>❌ <b>Incompatible Log File:</b> sorry, this analyzer is only compatible with NetScriptFramework logs. If you are using Nolvus, your crash logs should be located at <code>[YOUR_DRIVE]\\Nolvus\\Instances\\Nolvus Ascension\\MODS\\overwrite\\NetScriptFramework\\Crash</code></li>';
				diagnosesCount++;
			}

			// Check for .STRINGS crash
			var R14StringsRegex = /R14.*\.STRINGS/; // Regular expression to match "R14" and ".STRINGS" on the same line
			if (R14StringsRegex.test(logsTopHalf)) {
				diagnoses += '<li>🎯 <b>.STRINGS Crash Detected:</b> Remove any unique character in your <b>skyrim.ini</b> file\'s <code>sLanguage=ENGLISH</code> line.  More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-1">.STRINGS Crash</a/>.</li>';
				diagnosesCount++;
			}

			// Check for VRAMr Gorehowl crash (specific variant of D6DDDA crash)
			if (logsFirstLine.includes('D6DDDA') && relevantObjectsSection.includes('Gorehowl')) {
				diagnoses += '<li>🎯 <b>VRAMr Gorehowl Crash Detected:</b> If you are using VRAMr, try temporarily disabling VRAMr\'s output mod to get past the "Night at the Museum" quest, and then re-enable afterwards. Alternately, delete the "clgorehowl" textures .dds image files. Or, just hide their VRAMr overrides in MO2. <code>NOTE: the VRAMr mod author fixed this issue in his April 19, 2024 version.</code></li>';
				diagnosesCount++;
			}

			// Check for JContainers crash
			if (logsFirstLine.includes('JContainers64.dll+10AE45')) {
				diagnoses += '<li>🎯 <b>JContainers Crash Detected:</b> Go to <a href="https://www.nexusmods.com/skyrimspecialedition/mods/108591?tab=files&file_id=458596">Discrepancy\'s patch settings hub</a> and add the <b>JContainers Crash Workaround</b> mod (from the "Files" section) into Mod Organizer 2 (MO2). If you would like guidance on modding/patching Nolvus, please watch this <a href="https://youtu.be/YOvug9KP5L4">brief tutorial video</a> for step-by-step instructions. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-4">JContainers Crash</a/>.</li>';
				diagnosesCount++;
			}
			// Check for Gravelord / Mihail Sithis crash
			var matchGravelordMatches = logsTopHalf.match(/mihailmmasithis\.esp/g) || [];
			if (matchGravelordMatches && matchGravelordMatches.length >= 1) {
				diagnoses += '<li>🎯 <b>Gravelord / Mihail Sithis Crash Detected:</b> Go to <a href="https://www.nexusmods.com/skyrimspecialedition/mods/108591">Discrepancy\'s patch settings hub</a> and download the <b>Odin and Gravelords Compatibility Patch﻿</b>. In the installation wizard, for vanilla Nolvus Ascension version 5, choose the top option for the Gravelords Standalone version (mihailmmasithis.esp). This patch can be safely installed mid-game. If you would like guidance on modding/patching Nolvus, please watch this <a href="https://youtu.be/YOvug9KP5L4">brief tutorial video</a> for step-by-step instructions. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-8">Gravelord / Mihail Sithis Crash</a/>.</li>';
				diagnosesCount++;
			}

			// Check for A0D789 crash
			if (logsFirstLine.includes('(SkyrimSE.exe+A0D789)')) {
				diagnoses += '<li>🎯 <b>A0D789 Crash Detected:</b> Reload game and continue playing, or alternatively, add the <a href="https://www.patreon.com/posts/se-ae-69951525">[SE/AE]A0D789patch</a> patch by kingeric1992 into Mod Organizer (MO2). If you would like guidance on modding/patching Nolvus, please watch this <a href="https://youtu.be/YOvug9KP5L4">brief tutorial video</a> for step-by-step instructions. NOTE: this specific patch does NOT have a plugin that shows up in the right side of MO2. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-10">A0D789 Crash</a/>.</li>';
				diagnosesCount++;
			}

			// Check for USVFS crash
			if (probableCallstackSection.toLowerCase().includes('usvfs_x64.dll')) {
				diagnoses += '<li>🎯 <b>USVFS Crash Detected:</b> An antivirus (most frequently, Webroot or Bitdefender) is blocking the MO2 file system. Either change your antivirus, or disable your antivirus, and/or create an exception for the entire Nolvus directory. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-12">USVFS Crash</a/>.</li>';
				diagnosesCount++;
			}
			// Check for Alphabetized Load Order crash
			var percentAlphabetized = getPercentAlphabetized(logFile);
			if (percentAlphabetized > 70) {
				diagnoses += '<li>🎯 <b>Alphabetized Load Order Detected:</b> This log file\'s .esp mods are ' + percentAlphabetized + '% alphabetized in their load order. Open the Nolvus Dashboard, click on "Manage" then "Instance". Once loaded, click on <b>"Apply Order"</b>. For more information and a screenshot, see this r/Nolvus post <a href="https://www.reddit.com/r/Nolvus/comments/1chuod0/how_to_apply_order_button_usage_in_the_nolvus/">How To: "Apply Order" button usage in the Nolvus Dashboard</a>. Also, if you have customized Nolvus with additional mods, review information on the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-7">Load Order Crash</a>. ⚠️NOTE: Any added mods will be disabled and moved to the bottom of your list, so you\'ll have to manually re-order and re-enable those, but your vanilla Nolvus mods will be returned to their intended order.</li>';
				diagnosesCount++;
			}

			// Check for 12F4797 Physics crash
			if (logsFirstLine.toLowerCase().includes('12F4797'.toLowerCase()) && relevantObjectsSection.toLowerCase().includes("NiCamera(Name: `WorldRoot Camera`)".toLowerCase()) && relevantObjectsSection.toLowerCase().includes("BSMultiBoundRoom(Name: null)".toLowerCase())) {
				diagnoses += '<li>🎯 <b>12F4797 Physics Crash Detected:</b> This issue is commonly encountered in Ancestor Glade (or possibly from a recent save made from Ancestor Glade) and may be linked to having a large number of physics-enabled objects active at once, such as the player\'s own armor and hair. The <b>workaround</b> is to swap out these items for non-physics counterparts. Also, if your character or follower has physics enabled hair, you should wear a non-physics helmet to cover cover it up.</li>';
				diagnosesCount++;
			}

			//NVIDIA graphics driver
			if (logsFirstLine.toLowerCase().includes('nvwgf2umx.dll') || logsFirstLine.toLowerCase().includes('nvlddmkm.sys') || logsFirstLine.toLowerCase().includes('nvoglv32.dll') || logsFirstLine.toLowerCase().includes('nvoglv64.dll') || logsFirstLine.toLowerCase().includes('nvwgf2um.dll') || logsFirstLine.toLowerCase().includes('nvapi64.dll')) {
				diagnoses += '<li>🎯 <b>NVIDIA Driver Issue Detected:</b> The appearance of NVIDIA driver .dll files in the first line of your crash log is often associated with NVIDIA graphics driver issues. To resolve this, try the following steps:<ol>' +
					'<li><b>Update your NVIDIA drivers</b> to the latest version. You can download the latest drivers from the <a href="https://www.nvidia.com/Download/index.aspx">NVIDIA website</a>.</li>' +
					'<li>Check for any GPU overclocking settings that may be causing instability and reset them to default if necessary.</li>' +
					'<li>If the above does not resolve the issue, try performing a clean installation of the drivers using a tool like Display Driver Uninstaller (DDU) to remove all traces of the previous drivers before installing the new ones.</li>' +
					'</ol></li>';
				diagnosesCount++;
			}


			//SkyrimUpscaler crash
				// Files names from Puredark's Upscalers:
				// All three: SkyrimUpscaler.dll, nvngx_dlss.dll, PDPerfPlugin.dll
				// Free version: (nothing else added besides those shared by all three (see above))
				// V11 adds: XeFX_Loader.dll, ffx_fsr2_api_dx12_x64.dll, ffx_fsr2_api_x64.dll, igxess.dll, libxess.dll, XeFX.dll
				// V12 adds: ffx_fsr2_api_x64.dll, ffx_fsr2_api_dx11_x64.dll, libxess.dll
				// FSR3 version for RTX 40xx series has:  nvngx_dlssg.dll, nvngx_dlss.dll, ("All three" above?), (more ???)
				// NOTE: apparently not all of the above show up in crash logs, but I'm listing them here for reference
			if (logsFirstLine.toLowerCase().includes('nvngx_dlss.dll') || logsFirstLine.toLowerCase().includes('PDPerfPlugin.dll'.toLowerCase()) || logsFirstLine.toLowerCase().includes('SkyrimUpscaler.dll'.toLowerCase())) {
				diagnoses += '<li>🎯 <b>Upscaler Issue Detected:</b> The appearance of ‘SkyrimUpscaler.dll,’ ‘PDPerfPlugin.dll,’ or ‘nvngx_dlss.dll’ in the first line of your crash log is often associated with NVIDIA graphics drivers and/or Puredark’s upscalers. To resolve this, try the following steps:<ol>' +
					'<li><b>Update your NVIDIA drivers</b> to the latest version. You can download the latest drivers from the <a href="https://www.nvidia.com/Download/index.aspx">NVIDIA website</a>.</li>' +
					'<li>If you are using one of Puredark\'s <a href="https://www.patreon.com/collection/50002?view=expanded">paid FSR2 or FSR3 Upscalers</a> (rather than his free FSR2 version included with Nolvus): <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' +
						'<li><b>Check hardware compatibility:</b> This issue may also arise due to incompatible hardware (e.g., AMD instead of NVIDIA, GTX instead of RTX, RTX non-40xx instead of RTX 40xx).</li>' +
						'<li><b>Review settings:</b> Ensure that you follow the recommended settings in the <a href="https://www.reddit.com/r/Nolvus/wiki/help/guides/dlss/">Nolvus DLSS Upscaler Installation Guide</a>. Confirm that you have the correct version and settings for your graphics card.</li>' +
					'</ul></li>' +
					'<li>Check for any GPU overclocking settings that may be causing instability and reset them to default if necessary.</li>' +
					'<li>If the above does not resolve the issue, optionally try performing a clean installation of the drivers using a tool like Display Driver Uninstaller (DDU) to remove all traces of the previous drivers before installing the new ones.</li>' +
					'<li>Alternatively, disable the upscaler and opt for TAA (Temporal Anti-Aliasing), as demonstrated on the website under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-11">PDPerfPlugin Crash</a/>.</li>' +
					'<li>If issue persists, share your crash logs with <a href="https://www.reddit.com/r/Nolvus/">r/Nolvus</a> and/or the <a href="https://discord.gg/Zkh5PwD">Nolvus Discord</a></li>' +
					'</ol></li>';
				diagnosesCount++;
			}

			//Paid FSR3 Upscaler
			if (logsFirstLine.toLowerCase().includes('nvngx_dlssg.dll')) {
				diagnoses += '<li>🎯 <b>Paid FSR3 Upscaler Issue Detected:</b> Having the "nvngx_dlssg.dll" error showing up in the first line of your crash log is frequently linked to NVIDIA graphics drivers and/or Puredark\'s paid upsclaler (FG Build Alpha 03 and later). To resolve this, try the following steps:<ol>' +
					'<li><b>Update your NVIDIA drivers</b> to the latest version. You can download the latest drivers from the <a href="https://www.nvidia.com/Download/index.aspx">NVIDIA website</a>.</li>' +
					'<li><b>Incompatible settings in the upscaler:</b> Choosing a bad upscale type or other setting can cause this issue. Review and verify the recommended settings in <a href="https://www.reddit.com/r/Nolvus/wiki/help/guides/dlss/">Nolvus DLSS Upscaler Installation Guide</a>.</li>' +
					'<li><b>Incompatible hardware:</b> This issue can also be caused by incompatible hardware (AMD instead of NVIDIA, GTX instead of RTX, RTX non-40xx intead of  RTX 40xx, and so on).</li>' +
					'<li>Check for any GPU overclocking settings that may be causing instability and reset them to default if necessary.</li>' +
					'<li>If the above does not resolve the issue, try performing a clean installation of the drivers using a tool like Display Driver Uninstaller (DDU) to remove all traces of the previous drivers before installing the new ones.</li>' +
					'</ol></li>';
				diagnosesCount++;
			}

			// Check for D6DDDA crash
			if (logsFirstLine.toLowerCase().includes('D6DDDA'.toLowerCase())) {
				diagnoses += '<li>❗<b>D6DDDA Crash Detected:</b> This may occur when either RAM or VRAM has been exceeded or due to broken/corrupt meshes (.nif) or textures (.dds). Verify that you have correctly <a href="https://www.nolvus.net/appendix/pagefile">set your Windows Pagefile Size</a>. If you are playing vanilla Nolvus, and this issue is persistent, it could (rarely) also be an indicator of hardware issues. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-2">D6DDDA Crash</a/>.</li>';
				diagnosesCount++;
			}

			// Check for Shadow Scene Node crash
			if (probableCallstackSection.toLowerCase().includes('BSCullingProcess::unk_D51280+78'.toLowerCase()) && logsFirstLine.includes('(SkyrimSE.exe+12FDD00)')) {
				diagnoses += '<li>❗<b>Shadow Scene Node Crash Detected:</b> Load an earlier save, traveling to a different cell from the original crash, and play for a few days in game away from the area. This avoids the Shadow Scene, and hopefully allows the issue to resolve itself. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-3">Shadow Scene Node crash</a/>.</li>';
				diagnosesCount++;
			}

			//TODO: Custom mod found in Probable Callstack:  In customized you’ll likely find that there will be many direct mod related crashes which will list themselves. Most of the time it’s as simple as disabling or adjusting the load order of referenced mod

			// Check for Skeleton crash
			var skeletonRegex = /NPC L UpperarmTwist|NPC R UpperarmTwist|skeleton\.nif|skeleton_female\.nif|NPC L Forearm|NPC R Forearm|bisection|NPC SpineX|NPC L Heel|NPC R Heel|NPC L Foot|NPC R Foot|SaddleBone|NPC L Hand|NPC R Hand|NPC L Finger|NPC R Finger/g;
			var skeletonMatches = relevantObjectsSection.match(skeletonRegex) || [];
			if (skeletonMatches.length > 0) {
				diagnoses += '<li>❓<b>Possible Skeleton Issue:</b> Detected ' + skeletonMatches.length + ' potential indicators(s). Multiple indicators are more likely to be the cause than just one. Restarting may help if you\'re using vanilla Nolvus. For custom mods, verify your load order. Skeleton Issues are frequently NOT the crash culprit when other issues are present. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-9">Skeleton Crash</a/> and <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-7">Load Order Crash</a>.</li>';
				diagnosesCount++;
			}

			// Check for Shadowrend crash
			if (relevantObjectsSection.toLowerCase().includes('ccbgssse018-shadowrend.esl')) {
				diagnoses += '<li>❓<b>Possible Shadowrend Issue:</b> Try loading an earlier save and avoid the crash area for a few days. <b>Be cautious</b> when loading a save that previously experienced the Shadowrend crash. Continuing to play on such a save might compound the issue, leading to more frequent crashes. For custom mods, verify your load order. Shadowrend is frequently NOT the crash culprit when other issues are present. More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-6">Shadowrend Crash</a/> and <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-7">Load Order Crash</a>.</li>';
				diagnosesCount++;
			}

			// Default to unknown crash
			if (diagnoses == '') {
				diagnoses = '<li>❓<b>No recognized crash pattern detected.</b> If you aren\'t aware of (and diligently following) <b>Jerilith\'s Safe Save Guide</b>, review it at <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-5">Save Bloat Crash</a/>. Also, if you have customized Nolvus with additional mods, review information on the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-7">Load Order Crash</a>. If this issue persists, share your crash logs with <a href="https://www.reddit.com/r/Nolvus/">r/Nolvus</a> and/or the <a href="https://discord.gg/Zkh5PwD">Nolvus Discord</a>.</li>';
				//DON'T COUNT: diagnosesCount++;
			}

			console.log('Diagnoses:', diagnosesCount);


			// - - - Speculative Insights - - -
			// Rechecks of some of the above crash tests, just include mostly-AI-generated descriptions
			//(some tests weren't rechecked if they had an easy defitive solution, or if the AI didn't generate a good alternative description.
			// Some checks were inspired by work from sea (no code was used nor were any descriptions directly copied)
			// Acknowledgment:
			// Special thanks to "sea" for the diligent collection of crash identifiers and descriptions that were very helpful in the development of these speculative insights.
			// Created: 2023.04.22 by Sephrajin aka sri-arjuna aka (sea)
			// Licence: GPLv2
			// Source code: https://github.com/sri-arjuna/SSE-CLA
			// Nexus Mod page: https://www.nexusmods.com/skyrimspecialedition/mods/89860




			var insights = '';
			var insightsCount = 0;
			var isVanillaNolvus = false;
			//UNUSED? var isVanillaNolvusHtml = '';


			if (countPlugins(logFile) > 1) {
				var nonNolvusGamePluginsHtml = '';
				async function getNonNolvusGamePluginsHtml(logFile) {
					var outHtml = '';
					try {
						var nonVanillaPlugins = await getNonNolvusGamePlugins(logFile);
						nonVanillaPlugins = replaceWithExplainers(nonVanillaPlugins);
						if (nonVanillaPlugins.length > 0) {
							outHtml += '<details><summary>🔎 Non-Vanilla Nolvus Plugins Detected (<code>' + nonVanillaPlugins.length + '</code>):<br><code>(click to expand/collapse full list)</code></summary><ul>';
							for (let plugin of nonVanillaPlugins) {
								outHtml += '<li><code>' + plugin + '</code></li>';
							}
							outHtml += '</ul></details>';
							
							//Set the flag below the text area field
							document.getElementById('fileFlags').style.textAlign = "right";
							if(nonVanillaPlugins.length > 50) {
								document.getElementById('fileFlags').innerHTML = `<span style="float: right; white-space: nowrap;">🔧 <code>Customized (<span style="color: red;">${nonVanillaPlugins.length}</span>)<code></span><br>`;
							} else {
								document.getElementById('fileFlags').innerHTML = `<span style="float: right; white-space: nowrap;">🔧 <code>Customized (${nonVanillaPlugins.length})<code></span><br>`;
							}
						} else {
							document.getElementById('fileFlags').style.textAlign = "left";
							document.getElementById('fileFlags').innerHTML = '';
						}
						console.log('nonVanillaPlugins:', nonVanillaPlugins);  //DEBUGGING:
					} catch (error) {
						console.error(error);
					}
					return outHtml;
				}

				try {
					var nonNolvusGamePluginsHtml = await getNonNolvusGamePluginsHtml(logFile);
					if(nonNolvusGamePluginsHtml.length > 0) {
						isVanillaNolvus = false;
						insightsCount++;
						//isVanillaNolvusHtml = '<span style="display: block; text-align: right;"></span><br>';
					} else {
						nonNolvusGamePluginsHtml += '<details><summary>✅ Only Vanilla Nolvus Plugins Detected</summary></details>';
						isVanillaNolvus = true;
					}
				} catch (error) {
					console.error(error);
				}

				insights += nonNolvusGamePluginsHtml;
					


				var nonNolvusModulesHtml = '';
				async function getNonNolvusModulesHtml(logFile) {
					var outHtml = '';
					try {
						var nonVanillaModules = await getNonNolvusModules(logFile);
						nonVanillaModules = replaceWithExplainers(nonVanillaModules);
						if (nonVanillaModules.length > 0) {
							outHtml += '<details><summary>🔎 Non-Vanilla Nolvus Modules Detected (<code>' + nonVanillaModules.length + '</code>):<br><code>(click to expand/collapse full list)</code></summary><ul>';
							for (let module of nonVanillaModules) {
								outHtml += '<li><code>' + module + '</code></li>';
							}
							outHtml += '</ul></details>';
						}
						console.log('nonVanillaModules:', nonVanillaModules);  //DEBUGGING:
					} catch (error) {
						console.error(error);
					}
					return outHtml;
				}

				try {
					var nonNolvusModulesHtml = await getNonNolvusModulesHtml(logFile);
					if(nonNolvusModulesHtml.length > 0) {
						//isVanillaNolvus = false;
						insightsCount++;
						//isVanillaNolvusHtml = '<span style="display: block; text-align: right;"></span><br>';
					} else {
						nonNolvusModulesHtml += '<details><summary>✅ Only Vanilla Nolvus Modules Detected</summary></details>';
						//isVanillaNolvus = true;
					}
				} catch (error) {
					console.error(error);
				}

				insights += nonNolvusModulesHtml;

				var nonNolvusGamePluginsBelowSynthesisHtml = '';
				var hasNonNolvusPluginsAtBottom = false;
				var countNonNolvusPluginsAtBottom = 0;
				async function getNonNolvusGamePluginsBelowSynthesisHtml(logFile) {
					var outHtml = '';
					try {
						var nonNolvusPluginsAtBottom = await getNonNolvusGamePluginsBelowSynthesis(logFile);
						nonNolvusPluginsAtBottom = replaceWithExplainers(nonNolvusPluginsAtBottom);
						countNonNolvusPluginsAtBottom = nonNolvusPluginsAtBottom.length;
						if (countNonNolvusPluginsAtBottom > 0) {
							outHtml += '<details><summary>🔎 Non-Nolvus Plugins Detected at Bottom (<code>' + countNonNolvusPluginsAtBottom + '</code>):<br><code>(click to expand/collapse full list)</code></summary> This list identifies non-Nolvus plugins from your game\'s crash log that might be out of their intended load order. Typically, non-Nolvus plugins should be placed above <code>FNIS.esp</code>, but it seems this is not the case here. Please ensure these plugins are positioned as intended.<ul>';
							for (let plugin of nonNolvusPluginsAtBottom) {
								outHtml += '<li><code>' + plugin + '</code></li>';
							}
							outHtml += '</ul></details>';
							hasNonNolvusPluginsAtBottom = true;
						} else {
							outHtml += '<details><summary>✅ No non-Nolvus Plugins at Bottom</summary></details>';
							hasNonNolvusPluginsAtBottom = false;
						}
						console.log('nonNolvusPluginsAtBottom:', nonNolvusPluginsAtBottom);  //DEBUGGING:
					} catch (error) {
						console.error(error);
					}
					return outHtml;
				}

				try {
					var nonNolvusGamePluginsBelowSynthesisHtml = await getNonNolvusGamePluginsBelowSynthesisHtml(logFile);
					if(nonNolvusGamePluginsBelowSynthesisHtml.length > 0) {
						insightsCount++;
					} 
				} catch (error) {
					console.error(error);
				}

				insights += nonNolvusGamePluginsBelowSynthesisHtml;
			}


			var missingVanillaPluginsHtml = '';
			async function getMissingVanillaPluginsHtml(logFile) {
				var outHtml = '';
				try {
					var missingPlugins = await getMissingVanillaPlugins(logFile);
					missingPlugins = replaceWithExplainers(missingPlugins);
					if (missingPlugins.length > 0) {
						outHtml += '<details><summary>🔎 Potentially Missing Vanilla Plugins (<code>' + missingPlugins.length + '</code>):<br><code>(click to expand/collapse full list)</code></summary> NOTE: Every Nolvus configuration is likely to be missing  at least a few dozen plugins, which are only installed for specific configurations. It appears that even vanilla configurations will likely be missing anywhere from 50 to over 100 plugins. A vanilla install of the Redux variant can be missing over 200 plugins. Moreover, some crashes won’t include most of the installed plugins in the log file, leading to a list where most, if not all, the vanilla plugins appear as missing. Nonetheless, if you suspect that an important plugin may be missing, this is the place to verify.<ul>';
						for (let plugin of missingPlugins) {
							outHtml += '<li><code>' + plugin + '</code></li>';
						}
						outHtml += '</ul></details>';
					} else {
						outHtml += '<details><summary>✅ No Missing Vanilla Plugins Detected</summary></details>';
						hasBadlyOrganizedNolvusPlugins = false;
					}	
					console.log('missingPlugins:', missingPlugins);  //DEBUGGING:
				} catch (error) {
					console.error(error);
				}
				return outHtml;
			}

			try {
				var missingVanillaPluginsHtml = await getMissingVanillaPluginsHtml(logFile);
				if(missingVanillaPluginsHtml.length > 0) {
					insightsCount++;
				}
			} catch (error) {
				console.error(error);
			}

			insights += missingVanillaPluginsHtml;




			if (countPlugins(logFile) > 1) {
				var badlyOrganizedNolvusPluginsHtml = '';
				var hasBadlyOrganizedNolvusPlugins = false;
				async function getBadlyOrganizedNolvusPluginsHtml(logFile) {
					var outHtml = '';
					try {
						var badlyOrderedVanillaPlugins = await getBadlyOrganizedNolvusPlugins(logFile);
						badlyOrderedVanillaPlugins = replaceWithExplainers(badlyOrderedVanillaPlugins);
						if (badlyOrderedVanillaPlugins.length > 0) {
							outHtml += '<details><summary>🔎 Possibly Misordered Vanilla Nolvus Plugins (<code>' + badlyOrderedVanillaPlugins.length + '</code>):<br><code>(click to expand/collapse full list)</code></summary> This list identifies Nolvus plugins from your game\'s crash log that may be out of their standard order. It compares the order of plugins in your crash log with the standard order of vanilla Nolvus plugins. The plugins in the list are those that seem to be out of order, which could potentially lead to game crashes. Returning these plugins to their original order may help improve game stability. NOTE: A few may shift slightly with different vanilla configurations.<ul>';
							for (let plugin of badlyOrderedVanillaPlugins) {
								outHtml += '<li><code>' + plugin + '</code></li>';
							}
							outHtml += '</ul></details>';
							hasBadlyOrganizedNolvusPlugins = true;
						} else {
							outHtml += '<details><summary>✅ All Vanilla Nolvus Plugins are Well Ordered</summary></details>';
							hasBadlyOrganizedNolvusPlugins = false;
						}
						console.log('badlyOrderedVanillaPlugins:', badlyOrderedVanillaPlugins);  //DEBUGGING:
					} catch (error) {
						console.error(error);
					}
					return outHtml;
				}

				try {
					var badlyOrganizedNolvusPluginsHtml = await getBadlyOrganizedNolvusPluginsHtml(logFile);
					if(badlyOrganizedNolvusPluginsHtml.length > 0) {
						insightsCount++;
					} 
				} catch (error) {
					console.error(error);
				}

				insights += badlyOrganizedNolvusPluginsHtml;
			}


	


			

			insights += '<h5>Log Summary:</h5><ul>';

			if(countPlugins(logFile) > 2000) { //TODO: refine this number up?  //NOTE: this report can't be accurate unless plugins have been reported in the log file
				insights += '<li>🔎 <b>Log Insights:</b> (not 100% accurate)<ul>' +
					'<li>Vanilla or Customized: <code><b>' + (isVanillaNolvus ? 'vanilla' : 'customized') + '</b></code></li>' +
					'<li>Nolvus Variant: <code><b>' + reduxOrUltraVariant(logFile) + '</b></code></li>' +
					'<li>Advanced Physics: <code>' + hasPhysics(logFile) + '</code></li>' +
					'<li>Hardcore Mode: <code>' + hasHardcoreMode(logFile) + '</code></li>' +
					'<li>Fantasy Mode: <code>' + hasFantasyMode(logFile) + '</code></li>' +
					'<li>Alternate Leveling: <code>' + hasAlternateLeveling(logFile) + '</code></li>' +
					'<li>SSE FPS Stabilizer: <code>' + hasSseFpsStabilizer(logFile) + '</code></li>' +
					'<li>Paid Upscaler: <code>' + hasPaidUpscaler(logFile) + '</code></li>' +
					'<li>FSR3: <code>' + hasFSR3(logFile) + '</code></li>' +
					'<li>Occurrences of NULL and void: <code>' + countNullVoid(logsTopHalf) + ' (probably meaningless?)</code></li>' +
					'</ul>';
			}

			// Define the sections to count lines in
			const sections = [
				{ name: 'Possible relevant objects', min: 0, max: 50 },
				{ name: 'Probable callstack', min: 0, max: 500 },
				{ name: 'Registers', min: 0, max: 500 },
				{ name: 'Stack', min: 20, max: 600 },
				{ name: 'Modules', min: 270, max: 305 },
				{ name: 'Plugins', min: 2, max: 3 },
				{ name: 'Game plugins', min: 2215, max: 2400 },
			];

			// Initialize an object to store the line counts
			let lineCounts = {};

			// Loop over each section
			for (const section of sections) {
				// Find the start and end of the section
				const start = logFile.indexOf(section.name);
				const dataStart = logFile.indexOf('{', start);
				const dataEnd = logFile.indexOf('}', start);

				// If the section was found, count the lines and store the count
				if (start !== -1 && dataStart !== -1 && dataEnd !== -1) {
					let sectionHeader = logFile.slice(start, dataStart);
					if (sectionHeader.includes('(')) {
						// If the section header contains a count in parentheses, extract the count
						let sectionCount = sectionHeader.slice(sectionHeader.indexOf('(') + 1, sectionHeader.indexOf(')')).trim();
						const count = parseInt(sectionCount);
						lineCounts[section.name] = count;
					} else {
						// If the section header does not contain a count, count the lines in the section
						const sectionContent = logFile.slice(dataStart, dataEnd);
						let lines = sectionContent.split('\n').filter(line => line.trim() !== '');
						lineCounts[section.name] = lines.length - 1; // Subtract 1 to exclude the opening brace
					}
				} else {
					lineCounts[section.name] = 0;
				}
			}

			// Create the insights message
			if (Object.keys(lineCounts).length > 0) {
				insights += '<li>🔎 <b>Line Counts</b> for each section in the log file: <ul>';
				for (let section of sections) {
					let count = lineCounts[section.name];
					let warning = '';
					if (count < section.min || count > section.max) {
						insights += `<li>${section.name}:&nbsp; <code>${count.toLocaleString()} ⚠️<b>expected between ${section.min.toLocaleString()} and ${section.max.toLocaleString()}</b></code></li>`;
					} else {
						insights += `<li>${section.name}:&nbsp; <code>${count.toLocaleString()}</code></li>`;
					}
				}
				insights += '</ul></li>';
				insightsCount++;
			}
			console.log('sections:', sections);



			function containsKeyword(line) {
				// Define the keywords
				const keywords = ['.dds', '.tga', '.bmp', '.nif', '.esl', '.esp', '.esm', '.pex', '.dll', '.exe', '.ini', '.bsa', '.fuz', '.hkx', '.seq', '.swf', 'name:', 'file:'];

				// Convert the line to lowercase for case-insensitive comparison
				const lowerCaseLine = line.toLowerCase();

				// Initialize a counter for the number of matches
				let matchCount = 0;

				// Check if the line contains any of the keywords
				keywords.forEach(keyword => {
					if (lowerCaseLine.includes(keyword)) {
						matchCount++;
					}
				});

				// Return the number of matches
				return matchCount;
			}

			function addMatch(potentialMatch, allMatches, removeList) {
				if (potentialMatch && !removeList.includes(potentialMatch.toLowerCase())) {
					allMatches.push(potentialMatch);
					return 1;
				}
				return 0;
			}


			const fileExtensions = [
				'.bat', '.bik', '.bmp', '.bsa', '.bsl', '.dds', '.dll', '.esl', '.esm',
				'.esp', '.exe', '.fuz', '.hkx', '.ini', '.lip', '.nif', '.pex', '.psc',
				'.seq', '.skse', '.skse64', '.swf', '.tga', '.tri'
			];

			const fileStartCharacter = ['`', '"', ':', '('];

			const nameStartCharacter = ['`', '"'];

			// List of common metadata and items likely to be duplicate entries
			const removeList = [
				//'char*',
				'Dawnguard.esm',
				'Dragonborn.esm',
				'null',
				'null)',
				'NetScriptFramework',
				'SkyrimSE.exe',
				'skyrim.esm',
				//'void*',
			].map(item => item.toLowerCase());

			// Split the logs into lines
			//BUG: const lines = logsTopThird.split('\n'); //BUG: creates empty lines in the array where there are way too many characters in a line (Gravelord has a line with 24k+ characters)

			const maxLineLength = 1000; // Adjust this value to your needs

			// Split the logs into chunks of maxLineLength characters (can't use logsTopThird.split('\n') because it is incompatible with extra long log lines)
			let lines = [];
			let start = 0;
			let end = 0;
			let lineEnd = 0;

			while (start < logsTopThird.length) {
				lineEnd = logsTopThird.indexOf('\n', start);
				if (lineEnd === -1) {
					//If there are no more newlines, then we are at the end of the logsTopThird
					stringEnd = logsTopThird.length;
					lineEnd = stringEnd;
				}
				if (lineEnd > start + maxLineLength) {
					//If the line is too long, we need to shorten it
					stringEnd = start + maxLineLength;
				} else {
					stringEnd = lineEnd;
				}

				let line = logsTopHalf.substring(start, stringEnd);
				lines.push(line);
				start = lineEnd + 1;
			}
			//DEBUGGNG: console.log('lines:', lines);


			let allMatches = [];
			let missedMatches = [];
			lines.forEach(line => {
				if (line === '') return;
				let foundMatchCount = 0;
				let words = line.split(' ');

				function addMatch(potentialMatch, allMatches, removeList) {
					if (potentialMatch && !removeList.includes(potentialMatch.toLowerCase())) {
						allMatches.push(potentialMatch);
						return 1;
					}
					return 1; //Was 0, but I think it better if always 1 so that the missedMatches array is more accurate
				}

				fileExtensions.forEach(extension => {
					if (line.includes(extension)) {
						let index = line.lastIndexOf(extension);
						let end = index + extension.length;
						let start = index;
						let tempFileStartCharacter = [...fileStartCharacter];
						//Find the start by searching backwards:
						while (start > 0) {
							let char = line.charAt(start - 1);
							if (char === ')') {
								//If we find a closing parenthesis, skip to the matching opening parenthesis
								tempFileStartCharacter = tempFileStartCharacter.filter(item => item !== '(');
							}
							if (tempFileStartCharacter.includes(char)) {
								break;
							}
							start--;
						}
						let potentialMatch = line.slice(start, end).trim();
						foundMatchCount += addMatch(potentialMatch, allMatches, removeList);
					}
				});

				["Name:", "File:"].forEach(keyword => {
					if (line.match(new RegExp(`${keyword}`))) {
						let index = line.indexOf(keyword) + keyword.length;
						let start = index;
						let delimiter = '';
						//Find the start character:
						while (start < line.length) {
							let char = line.charAt(start);
							if (nameStartCharacter.includes(char) || (char >= 'a' && char <= 'z') || (char >= 'A' && char <= 'Z') || (char >= '0' && char <= '9')) {
								if (nameStartCharacter.includes(char)) {
									delimiter = char;
								}
								break;
							}
							start++;
						}
						if (!/[a-zA-Z0-9]/.test(line.charAt(start))) {
							start++;
						}
						//Find the end character:
						let end = start;
						while (end < line.length) {
							let char = line.charAt(end);
							if (char === delimiter || char === ',' || char === '\t' || char === '\n' || char === '\r') {
								break;
							}
							end++;
						}

						//Match: the Name/File substring:
						let potentialMatch = line.slice(start, end);
						foundMatchCount += addMatch(potentialMatch, allMatches, removeList);
					}
				});

				if (foundMatchCount < containsKeyword(line)) {
					missedMatches.push(line);
				}
			});

			console.log(' ');
			console.log('missedMatches:', missedMatches);
			console.log('allMatches:', allMatches);

			// List of files to filter
			const unlikelyCulpritsList = [
				'clr.dll',
				//'d3d11.dll',
				'D3D12Core.dll',
				'D3DCOMPILER_47.dll',
				'kernel32.dll',
				'kernelbase.dll',
				'MSVCP140.dll',
				'ntdll.dll',
				'Runtime.dll',
				'steamclient64.dll',
				'System.ni.dll',
				'ucrtbase.dll',
				'uiautomationcore.dll',
				'vcruntime140.dll',
				'win32u.dll',
				'XINPUT1_3.dll'
			].map(item => item.toLowerCase());


			allMatches = allMatches.map(item => {
				// Remove "File:" and quotes
				//REMOVE: let processedItem = item.replace(/File: /i, "").replace(/['`"]/g, "");
				let processedItem = item;
				// If the item is in the filter list, wrap it in parentheses and add a note
				if (unlikelyCulpritsList.includes(processedItem.toLowerCase())) {
					processedItem = `(${processedItem} ... unlikely culprit)`;
				}

				// If the item is in the explainers list, append the explanation
				if (explainersMap.has(processedItem.toLowerCase())) {
					processedItem += ` ${explainersMap.get(processedItem.toLowerCase())}`;
				}
				// Check if the line contains any removable lines
				// const isRemovable = removeList.some(removable => processedItem.toLowerCase().includes(removable));
				// if (isRemovable) {
				// 	return undefined;
				// } else {
				// 	return processedItem;
				// }
				return processedItem;
			}).filter(item => item !== undefined);

			// Process the matches
			const processedMatches = processListItems(allMatches);

			// Create the insights message
			if (allMatches.length > 0) {
				insights += '<li>🔎 <b>Files/Elements</b> listed within the heading, "Possible relevant objects", "Probable callstack", and "Registers" sections of the log file. Higher in this list are frequently more likely to have contributed more towards the crash. Pay extra attention to anything related to <b>mods you have added</b> to Nolvus:'
				insights += '<ul>' + processedMatches + '</ul>'
				insights += '</li>';
				insightsCount++;
			}




			insights += '</ul><h5>Higher-Confidence Test Results:</h5><ul>';

			//VRAMr Gorehowl
			if (logsFirstLine.includes('D6DDDA') && relevantObjectsSection.includes('Gorehowl')) {
				insights += '<li>🎯 <b>VRAMr Gorehowl Crash Detected:</b> The \'D6DDDA\' error, combined with references to the weapon "Gorehowl," indicates a specific issue related to VRAMr and the "Night at the Museum" quest. To address this issue:<ol>' +
					'<li>If you are using VRAMr, temporarily disable VRAMr\'s output mod.</li>' +
					'<li>After completing the quest, re-enable VRAMr\'s output mod.</li>' +
					'<li>Alternatively, you can delete the "clgorehowl" .dds texture files associated with the quest.</li>' +
					'<li>Or, consider hiding their overrides in MO2 to prevent conflicts.</li>' +
					'<li>NOTE: the VRAMr mod author fixed this issue in his April 19, 2024 version.</li>' +
					'</ol></li>';
				insightsCount++;
			}
			//Strings
			if (R14StringsRegex.test(logsTopHalf)) {
				insights += '<li>🎯 <b>.STRINGS Crash Detected:</b> This error typically occurs when there is a unique or non-standard character in the <code>sLanguage</code> line of your <b>skyrim.ini</b> file. To resolve this issue:<ol>' +
					'<li>Open your <b>skyrim.ini</b> file located in the Documents/My Games/Skyrim folder.</li>' +
					'<li>Locate the line that reads <code>sLanguage=ENGLISH</code>.</li>' +
					'<li>Ensure that there are no unique characters or typos in this line. It should only contain standard text.</li>' +
					'<li>Save the changes and restart Skyrim to see if the issue has been resolved.</li>' +
					'<li>More information and troubleshooting tips under <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-1">.STRINGS Crash</a/>.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//USVFS (Antivirus)
			if (probableCallstackSection.includes('usvfs_x64.dll')) {
				insights += '<li>🎯 <b>USVFS Crash Detected:</b> The presence of \'usvfs_x64.dll\' in the crash log indicates an issue related to the MO2 (Mod Organizer 2) file system. This crash is often caused by <b>antivirus software</b>, particularly Webroot or Bitdefender, blocking MO2\'s file operations. To resolve this issue:<ol>' +
					'<li>Check if you have Webroot or Bitdefender antivirus installed.</li>' +
					'<li>Temporarily disable your antivirus or create an exception for the entire Nolvus directory within your antivirus settings.</li>' +
					'<li>Ensure that MO2 has the necessary permissions to access and modify files without interference from the antivirus.</li>' +
					'<li>For detailed troubleshooting tips, refer to the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-12">USVFS Crash section</a> on the Nolvus support page.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//ENB issue (long, but collapsable version)
			if (logsFirstLine.includes('d3d11.dll')) {
				insights += '<li>❗ <b>ENB Issue Detected:</b> The presence of <code>d3d11.dll</code> in the first line of a crash log indicates a graphics-related crash. If you have recently installed an ENB or Reshader, ensure it is the correct version and consider reinstalling it. Follow the appropriate steps based on your installation method:<ol>' +
					'<li>❗ <b>For Manual Installers/Modders:</b> If you manually installed an ENB or similar:<a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' +
						'<li>For manual installations of standard Nolvus options, refer to the <a href="https://www.nolvus.net/guide/natl/enb">Guide on ENB & RESHADE Installation</a>.</li>' +
						'<li>For information on the new Cabbage ENB and Kauz ENB, see the <a href="https://www.reddit.com/r/Nolvus/comments/1clurux/nolvus_enb_install_guides_and_info/">Nolvus ENB Installation Guides and Information</a>.</li>' +
					'</ul></li>' +
					'<li>❗ <b>For Autoinstallers:</b> Consider the following steps for fixing your ENB-related issue:<a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' +
						'<li>For a potential <b>quick fix,</b> standard Nolvus players can try manually reinstalling the <code>d3d11.dll</code> file by following the instructions in the <a href="https://www.nolvus.net/guide/natl/enb">Guide on ENB & RESHADE Installation</a>. If this does not resolve the issue, proceed with the steps below.</li>' +
						'<li><b>Reinstalling Nolvus</b> may seem daunting, but <b>as long as you archived</b> during installation, the process is straightforward and <b>far faster.</b></li>' +
						'<li><b>⚠️ CAUTION:</b> Reinstalling Nolvus will delete your save games, character presets, and screenshots. Please <b>back them up</b> first if you wish to keep them! <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' +
							'<li>Game saves (.ess and .skse files) are located in <code>\\Nolvus\\Instances\\Nolvus Ascension\\MODS\\profiles\\Nolvus Ascension\\saves</code></li>' +
							'<li>Screenshots are saved in <code>\\Nolvus\\Instances\\Nolvus Ascension\\SHOTS</code></li>' +
							'<li>Character presets are located in <code>\\Nolvus\\Instances\\Nolvus Ascension\\MODS\\overwrite\\SKSE\\Plugins\\Chargen\\Presets</code></li>' +
							'<li>Character head sculpts are located in <code>\\Nolvus\\Instances\\Nolvus Ascension\\MODS\\overwrite\\SKSE\\Plugins\\Chargen</code></li>' +
						'</ul></li>' +
						'<li>Close Mod Organizer 2 (MO2) if it is currently open.</li>' +
						'<li>Open the Nolvus Dashboard.</li>' +
						'<li>Click the Manage button and select Delete Instance (see <a href="https://www.nolvus.net/appendix/installer/faq?acc=accordion-1-23">How to Delete an Instance</a>). NOTE: This will NOT delete your archives if you have enabled archiving.</li>' +
						'<li>Wait for the process to complete - this takes about 2 minutes depending on your system.</li>' +
						'<li>Once the process is complete, follow the prompts to install a new instance with your preferred settings. Please note that your game saves from another instance will not be compatible unless you choose the same settings.</li>' +
						'<li>If you previously enabled archiving, make sure the dashboard points to the correct Archive folder to prevent unnecessary re-downloads.</li>' +
					'</ul></li>' +
				'</ol></li>';
				insightsCount++;
			}

			//Apply Order
			if (hasBadlyOrganizedNolvusPlugins) {
				insights += '<li>❗<b>Potentially Misorganized Vanilla Nolvus Plugins:</b> If you are experiencing issues with your load order, you can use the <b>Apply Order</b> button in the Nolvus Dashboard to restore the original sorting of all vanilla Nolvus mods. Here is how to do it:<ol>' +
					'<li>Open the dashboard, click on <b>Manage</b> and then <b>Instance</b>.</li>' +
					'<li>When loaded, click on <b>Apply Order</b>.</li>' +
					'<li>All non-vanilla mods will be disabled and moved to the bottom of your load order.</li>' +
					'<li>Any disabled vanilla mods will again be enabled.</li>' +
					'<li>All vanilla Nolvus mods will be restored to their original sorting (load order).</li>' +
					'<li>This is useful if you are troubleshooting a load order and wish to start from a vanilla Nolvus state without reinstalling, if you accidentally moved one or more mods in Mod Organizer 2 (MO2), or if your load order somehow got corrupted.</li>' +
					'<li>For more information and a screenshot, see this r/Nolvus post <a href="https://www.reddit.com/r/Nolvus/comments/1chuod0/how_to_apply_order_button_usage_in_the_nolvus/">How To: "Apply Order" button usage in the Nolvus Dashboard</a>.</li>' +
					'</ol></li>';
					
				insightsCount++;
			}

			// Test for Non-Nolvus Plugins at Bottom
			if (hasNonNolvusPluginsAtBottom) {
				var nonNolvusPluginsAtBottomListItems = '';
				var nonNolvusPluginsAtBottom = await getNonNolvusGamePluginsBelowSynthesis(logFile);
				nonNolvusPluginsAtBottom = replaceWithExplainers(nonNolvusPluginsAtBottom);
				for (let plugin of nonNolvusPluginsAtBottom) {
					nonNolvusPluginsAtBottomListItems += '<li><code>' + plugin + '</code></li>';
				}
				insights += '<li>❗<b>Non-Nolvus Plugins Detected at Bottom:</b> <code>' + countNonNolvusPluginsAtBottom + '</code> Non-Nolvus plugins have been detected at the bottom of your load order. This could potentially cause issues with your game. Here is how to address this:<ol>' +
					'<li>Open Mod Organizer 2 (MO2).</li>' +
					'<li>In both the left and right-side panes, identify the non-Nolvus plugins at the bottom of your load order.</li>' +
					'<li>Move these plugins to their correct positions in the load order. Typically, non-Nolvus plugins should be placed above <code>FNIS.esp</code>. If you would like guidance on modding/patching Nolvus, please watch this <a href="https://youtu.be/YOvug9KP5L4">brief tutorial video</a> for step-by-step instructions.</li>' +
					'<li>Review information on the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-7">Load Order Crash</a>. If this issue persists, share your crash logs with <a href="https://www.reddit.com/r/Nolvus/">r/Nolvus</a> and/or the <a href="https://discord.gg/Zkh5PwD">Nolvus Discord</a>.</li>' +
					'<li>List of non-Nolvus plugins at bottom: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' +
						nonNolvusPluginsAtBottomListItems +
					'</ul></ol></li>';

				insightsCount++;
			}

			//D6DDDA
			if (logsFirstLine.includes('D6DDDA')) {
				insights += '<li>❗<b>D6DDDA Crash Detected:</b> The \'D6DDDA\' error may occur due to one of the following reasons:<ol>' +
					'<li>Exceeded RAM or VRAM: Ensure that your system has sufficient memory resources:<ol>' +
					'<li>Check if other applications are consuming excessive memory. Consider closing other applications.</li>' +
					'<li>Consider running your load order through <a href="https://www.nexusmods.com/skyrimspecialedition/mods/90557">VRAMr</a> to conserve both VRAM and RAM by compressing all/most of your load order\'s texture files in an automated fashion. This can reduce your load order\'s images to a smaller resolution (file size) without a noticeable decrease in image quality, and can lead to smoother performance and fewer memory-related issues.</li>' +
					'</ol></li>' +
					'<li>Broken/Corrupt Meshes (.nif) or Textures (.dds): Verify the integrity of your installed mods. Corrupted files can lead to crashes:<ol>' +
					'<li><a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Assets Optimizer (CAO)</a> can often be used to repair damaged image files. CAO ensures that textures are properly formatted and can also reduce their resolution (file size) without noticeably reducing visual quality.</li>' +
					'<li>Additionally, consider reaching out to the mod author if a specific mesh is identified as causing issues.</li>' +
					'</ol></li>' +
					'<li>Windows Pagefile Size: Verify that you have correctly <a href="https://www.nolvus.net/appendix/pagefile">set your Windows Pagefile Size</a>.</li>' +
					'<li>Hardware Issues (Rare): While uncommon, persistent D6DDDA crashes could indicate underlying hardware problems. Run a memory diagnostic tool to check for faulty RAM. Windows Memory Diagnostic or MemTest86 can be used for this purpose. Monitor your system for other signs of instability.</li>' +
					'</ol>For more detailed information and troubleshooting tips, refer to the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-2">D6DDDA Crash section</a> on the Nolvus support page.</li>';
				insightsCount++;
			}

			//NVIDIA graphics driver
			if (logsTopThirdNoHeading.toLowerCase().includes('nvwgf2umx.dll') || logsTopThirdNoHeading.toLowerCase().includes('nvlddmkm.sys') || logsTopThirdNoHeading.toLowerCase().includes('nvoglv32.dll') || logsTopThirdNoHeading.toLowerCase().includes('nvoglv64.dll') || logsTopThirdNoHeading.toLowerCase().includes('nvwgf2um.dll') || logsTopThirdNoHeading.toLowerCase().includes('nvapi64.dll')) {
				insights += '<li>❗<b>Potential NVIDIA Driver Issue Detected:</b> NVIDIA driver .dll files showing up in the top few sections of a crash log may be linked to NVIDIA graphics driver issues. To resolve this, try the following steps:<ol>' +
					'<li><b>Update your NVIDIA drivers</b> to the latest version. You can download the latest drivers from the <a href="https://www.nvidia.com/Download/index.aspx">NVIDIA website</a>.</li>' +
					'<li>If updating does not resolve the issue, perform a clean installation of the drivers using a tool like Display Driver Uninstaller (DDU) to remove all traces of the previous drivers before installing the new ones.</li>' +
					'<li>Check for any GPU overclocking settings that may be causing instability and reset them to default if necessary.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Memory issue (Missing Masters)
			// Check thought up by AI (MS Bing Copilot):
			if (logsTopHalf.includes('0xC0000005')) {
				insights += '<li>❗<b>Memory Access Violation Detected:</b> Error code 0xc0000005 points to memory-related issues, such as invalid memory access operations. Common causes and resolutions include:<ol>' +
					'<li><b>Missing Master Files:</b> Incompatibilities from a new mod may sometimes be resolved by installing <a href="https://www.nexusmods.com/skyrimspecialedition/mods/106441">Backported Extended ESL Support (BEES)</a>. If a mod was removed while others are still depending on it, see <a href="https://github.com/LivelyDismay/Learn-To-Mod/blob/main/lessons/Remove%20a%20Master.md">How To Remove a Master Requirement From a Plugin</a>.</li>' +
					'<li><b>Incompatible Mods:</b> Review your mod list for conflicts that could affect memory allocation or access.</li>' +
					'<li><b>File Format Versions:</b> Ensure all mods are compatible with your game version to prevent crashes from format mismatches.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Missing Master 2
			if (logsFirstLine.includes('5E1F22') || logsFirstLine.includes('05E1F22')) {
				insights += '<li>❗<b>Potential Missing Masters Detected:</b> Codes for 5E1F22 or 05E1F22 in the first line of a crash log may suggest a missing master files. MO2 will display a warning icon next to plugins that are missing their masters. This issue can arise from incompatibilities due to a newly added mod, which is sometimes resolvable by installing <a href="https://www.nexusmods.com/skyrimspecialedition/mods/106441">Backported Extended ESL Support (BEES)</a>. It can also occur when one mod is removed (or disabled) while another mod or patch still expects it to be present. In this scenario, refer to the following tutorial on <a href="https://github.com/LivelyDismay/Learn-To-Mod/blob/main/lessons/Remove%20a%20Master.md">How To Remove a Master Requirement From a Plugin</a>.</li>';
				insightsCount++;
			}

			// dxgi.dll issue (ReShade and PureDark Upscaler)
			if (logsTopHalf.includes('dxgi.dll')) {
				insights += '<li>❗<b>dxgi.dll Issue Detected:</b> The presence of dxgi.dll in the log\'s top half indicates a potential issue between ReShade and the PureDark Upscaler. Common causes and resolutions include:<ol>' +
					'<li><b>ReShade Version:</b> If you have upgraded your ReShade to a newer version (e.g., 6.11 for the latest Cabbage release), the older and customized dxgi.dll from PureDark might cause issues. See below if you wish to revert to the original Reshade.</li>' +
					'<li><b>PureDark Upscaler:</b> If you are using newer versions of the PureDark upscaler (specifically for 40xx cards), you need to download a customized version of dxgi.dll from their Discord for compatibility with ReShade.</li>' +
					'<li><b>Missing dxgi.dll:</b> If you want to revert back from PureDark and don\'t have the original dxgi.dll, you can find it in your archived mods installed from Nolvus. Alternatively, reinstall ReShade following the <a href="https://www.nolvus.net/guide/natl/enb">11.3 Reshade Binaries</a> instructions on the Nolvus site.</li>' +
					'<li><b>Workaround:</b> Alternatively, you can disable ReShade by pressing the DEL key to turn it on or off.' +
        			'</ol></li>';
				insightsCount++;
			}

			//Upscaler
			if (logsTopThird.toLowerCase().includes('upscaler.dll') || logsTopThird.toLowerCase().includes('pdperfplugin.dll')) {
				insights += '<li>❗<b>Potential Upscaler Issue Detected:</b> The error involving \'Upscaler.dll\' or \'PDPerfPlugin.dll\'suggests a problem with the Upscaler mod, which is designed to improve the game\'s graphics by increasing the resolution of textures. If you are using Puredark\'s paid Upscaler, consider the following troubleshooting steps:<ol>' +
					'<li>Ensure you are using the correct version of the upscaler that is compatible with your GPU.</li>' +
					'<li>Review the <a href="https://www.reddit.com/r/Nolvus/wiki/help/guides/dlss/">Nolvus DLSS Upscaler Installation Guide</a> to confirm that you have followed all the installation steps correctly.</li>' +
					'<li>Review the <b>SkyrimUpscaler.log</b> file for more detailed information about the error.</li>' +
					'<li>Temporarily disable the Upscaler mod to determine if it is the source of the crash.</li>' +
					'<li>Ensure that your system meets the hardware requirements for running the mod, as upscaling can be resource-intensive.</li>' +
					'<li>Check for updates to the Upscaler mod that may address known issues.</li>' +
					'<li>If the problem persists, report it to the mod\'s support page, providing details from the log file to assist with troubleshooting.</li>' +
					'</ol></li>';
				insightsCount++;
			}


			insights += '</ul><h5>Memory and Image-related Issues:</h5><ul>';

			//Out of RAM
			if (logsTopHalf.toLowerCase().includes('bad_alloc')) {
				insights += '<li>❓ <b>bad_alloc Issue Detected:</b> The \'bad_alloc\' error typically indicates that the game has run <b>out of RAM</b> memory. To address this issue, follow these steps:<ol>' +
					'<li>Close unnecessary applications to free up RAM.</li>' +
					'<li>Consider upgrading your system with more RAM if you frequently encounter memory issues.</li>' +
					'<li>Verify that you have correctly <a href="https://www.nolvus.net/appendix/pagefile">set your Windows Pagefile Size</a>.</li>' +
					'<li>Ensure that your mods are efficiently using memory and not exceeding your system\'s limits.</li>' +
					'<li>Consider switching to texture packs with lower resolutions (e.g., 1K or 2K instead of 4K) to reduce memory usage. Texture mods that are too large can strain both VRAM and RAM resources.</li>' +
					'<li>Conserve both VRAM and RAM by compressing all/most of your load order\'s texture (image) files in an automated fashion with <a href="https://www.nexusmods.com/skyrimspecialedition/mods/90557">VRAMr</a> reducing their size without a noticeable decrease in image quality. This can lead to smoother performance and fewer memory-related issues.</li>' +
					'</ol></li>';
				insightsCount++;
			}


			//Memory allocation failure
			if (logsTopHalf.toLowerCase().includes('no_alloc')) {
				insights += '<li>❓ <b>no_alloc Issue Detected:</b> The \'no_alloc\' error suggests a <b>memory allocation</b> failure, often due to mod conflicts or system limitations. To troubleshoot this issue, follow these steps:<ol>' +
					'<li>Run a memory diagnostic tool to check for faulty RAM. Windows Memory Diagnostic or MemTest86 can be used for this purpose.</li>' +
					'<li>Review your mod list to ensure there are no conflicts.</li>' +
					'<li>Reduce the number of mods installed, particularly if you have many large, resource-intensive mods.</li>' +
					'<li>Keep your mods updated, including any patches that improve memory management.</li>' +
					'<li>If the issue persists, disable mods one by one to isolate the problematic mod. Re-enable them gradually to maintain system stability.</li>' +
					'<li>Consider switching to texture packs with lower resolutions (e.g., 1K or 2K instead of 4K) to reduce memory usage. Texture mods that are too large can strain both VRAM and RAM resources.</li>' +
					'<li>Conserve both VRAM and RAM by compressing all/most of your load order\'s texture (image) files in an automated fashion with <a href="https://www.nexusmods.com/skyrimspecialedition/mods/90557">VRAMr</a> reducing their size without a noticeable decrease in image quality. This can lead to smoother performance and fewer memory-related issues.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//tbbmalloc memory allocation issues
			if (logsTopHalf.toLowerCase().includes('tbbmalloc.dll')) {
				insights += '<li>❓ <b>tbbmalloc.dll Issue Detected:</b> This indicator is associated with <b>memory allocation</b>. Its presence in the crash log suggests potential mod conflicts or the need for mod updates. Consider the following:<ol>' +
					'<li>Check for mod compatibility issues, especially with those that modify memory allocation.</li>' +
					'<li>Ensure all mods, particularly those related to memory management, are up to date.</li>' +
					'<li>Verify that you have correctly <a href="https://www.nolvus.net/appendix/pagefile">set your Windows Pagefile Size</a>.</li>' +
					'<li>Seek advice from the modding community if crashes persist after taking these steps.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Skeleton
			if (skeletonMatches.length > 0) {
				insights += '<li>❓ <b>Possible Skeleton Crash Detected:</b> The crash log suggests ' + skeletonMatches.length + ' potential skeleton integrity issues. Skeleton files are crucial for character and creature animations in Skyrim. A corrupted or incompatible skeleton file can lead to game instability. To address this:<ol>' +
					'<li>Verify the integrity of skeleton-related mods. Ensure that mods like XPMSSE are properly installed and not overwritten by other mods.</li>' +
					'<li>Check the load order for mods affecting skeletons. Use a mod manager to resolve conflicts and ensure proper priority.</li>' +
					'<li>Utilize tools such as FNIS or Nemesis to rebuild animations, particularly if you have mods that modify character or creature animations. Follow these instructions for <a href="https://www.nolvus.net/guide/asc/output/nemesis">regenerating Nemesis for Nolvus</a>.</li>' +
					'<li>Inspect other mods that may alter skeleton structures. Disable them sequentially to pinpoint the issue.</li>' +
					'<li>If identifiable, using <a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Asset Optimizer (CAO)</a> may help fix the problematic NIF file(s)</li>' +
					'</ol>For detailed steps and more troubleshooting advice, visit the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-9">Skeleton Crash</a> and <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-7">Load Order Crash</a> sections on Nolvus.</li>';
				insightsCount++;
			}

			//Corrupted NIF
			if (logsFirstLine.includes('12FDD00')) {
				insights += '<li>❓ <b>12FDD00 Detected:</b> This code often indicates a crash due to a <b>corrupt NIF file</b>. It\'s recommended to check for any recently installed mods that might have altered or added NIF files and ensure they are uncorrupted. If identifiable, using <a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Asset Optimizer (CAO)</a> may help fix the problematic NIF file(s). Additionally, consider reaching out to the mod author if a specific mesh is identified as causing issues.<ul>' +
				'<li>List of mentioned meshes: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
					extractNifPathsToListItems(logsTopHalf) +
				'</ul></ul></li>';
				insightsCount++;
			}

			//NIF
			if (logsTopHalf.toLowerCase().includes('trishape')) {
				insights += '<li>❓ <b>Trishape Issue Detected:</b> Trishapes are components of NIF files that define the shape of 3D objects in the game. An issue here is likely due to a mod providing a corrupt or incompatible mesh. To resolve this:<ol>' +
					'<li>Identify the mod responsible for the bad mesh by reviewing the list of mentioned meshes below.</li>' +
					'<li>Check for updates or patches for the mod that may address the issue.</li>' +
					'<li>If no updates are available, consider removing the mod and replacing it with an alternative or updated version.</li>' +
					'<li>If identifiable, using <a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Asset Optimizer (CAO)</a> may help fix the problematic NIF file(s).</li>' +

					'<li>List of mentioned meshes: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						 extractNifPathsToListItems(logsTopHalf) +
					'</ul></ol></li>';

				insightsCount++;
			}

			//Mesh (NIF, right?)
			if (logsTopHalf.toLowerCase().includes('mesh')) {
				insights += '<li>❓ <b>Possible Mesh Issue Detected:</b> This error indicates a generic mesh problem, which could be due to corrupt or incompatible mesh files. To address this issue:<ol>' +
					'<li>Review the list of mentioned meshes below to identify any recently added or updated mods that may include these files.</li>' +
					'<li>Check for updates or compatibility patches for the mods that provide these mesh files.</li>' +
					'<li>If identifiable, using <a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Asset Optimizer (CAO)</a> may help fix the problematic NIF file(s).</li>' +
					'<li>If issues persist, consider removing or replacing the problematic mod with an alternative.</li>' +
					'<li>List of mentioned meshes: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						 extractNifPathsToListItems(logsTopHalf) +
					'</ul></ol></li>';
				insightsCount++;
			}

			// Check thought up by AI (MS Bing Copilot):
			//Mesh Issue
			const meshIssueRegex = /Name: "([^"]+\.nif)"/i;
			var meshIssueMatch = logsTopHalf.match(meshIssueRegex);
			if (meshIssueMatch) {
				const meshName = meshIssueMatch[1];
				insights += '<li><b>Possible NIF Issue Detected:</b> The mesh file <b>' + meshName + '</b> may be causing the crash. Check for corrupt or incompatible mesh files.</li>';
				insightsCount++;
			}

			//NiNode
			if (logsTopHalf.toLowerCase().includes('NiNode'.toLowerCase())) {
				insights += '<li>❓ <b>NiNode Issue Detected:</b> NiNodes are related to the skeletal structure of characters and creatures in Skyrim. This error could indicate an incompatible skeleton or a bad mesh. To troubleshoot this issue:<ol>' +
					'<li>Read the descriptions of related mods and ensure the correct load order for skeleton-based mods. ⚠️Note: Avoid using tools like LOOT with Nolvus.</li>' +
					'<li>Make sure you have a compatible skeleton mod installed, such as XPMSSE, and that it is not being overwritten by another mod in your mod manager.</li>' +
					'<li>Run FNIS or Nemesis to regenerate animations, especially if you are using mods that alter character animations.  Follow these instructions for <a href="https://www.nolvus.net/guide/asc/output/nemesis">regenerating Nemesis for Nolvus</a>.</li>' +
					'<li>Check for any other mods that affect skeletons, not just humanoid but creatures too, and test by disabling them.</li>' +
					'<li>If identifiable, using <a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Asset Optimizer (CAO)</a> may help fix the problematic NIF file(s).</li>' +
					'<li>List of mentioned meshes: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						 extractNifPathsToListItems(logsTopHalf) +
					'</ul></ol></li>';
				insightsCount++;
			}

			//Head Mesh
			if (logsFirstLine.includes('132BEF')) {
				insights += '<li>❓ <b>132BEF Detected:</b> This error is often linked to a <b>head mesh</b> issue. To troubleshoot, follow these steps:<ol>' +
					'<li>Check the log for the last NPC loaded before the crash; this NPC\'s head mesh might be the source of the problem.</li>' +
					'<li>Verify that all head meshes are compatible with the current version of Skyrim and any installed body mods.</li>' +
					'<li>If a particular mod is identified, consider reinstalling it or checking for updates that address compatibility issues.</li>' +
					'<li>Regenerate facegen data for the NPC using Creation Kit or other specialized tools if the issue persists.</li>' +
					'<li>List of mentioned meshes: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						 extractNifPathsToListItems(logsTopHalf) +
					'</ul></ol></li>';
				insightsCount++;
			}

			//Face Gen
			if (logsFirstLine.includes('12F5590')) {
				insights += '<li>❓ <b>12F5590 Detected:</b> This error is often associated with a <b>face generation</b> issue for NPCs. To troubleshoot, follow these steps:<ol>' +
					'<li>Check the log for the last NPC loaded before the crash; this NPC is likely the source of the problem.</li>' +
					'<li>If a particular mod is identified, consider reinstalling it or checking for updates that address compatibility issues.</li>' +
					'<li>For persistent problems, regenerate facegen data for the NPC using Creation Kit or other specialized tools.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//RaceMenu
			if (logsTopHalf.toLowerCase().includes('skee64.dll')) {
				insights += '<li>❓ <b>skee64.dll Issue Detected:</b> This file is typically associated with <b>RaceMenu</b> and can indicate incompatibility issues with mods that affect character models or body meshes. To troubleshoot this issue:<ol>' +
					'<li>Check for any recent mod installations or updates that may have altered character models or body meshes.</li>' +
					'<li>Ensure that RaceMenu and all related mods are up to date and compatible with your version of Skyrim and SKSE.</li>' +
					'<li>Read the descriptions of related mods and ensure the correct load order, and verify that there are no conflicts between mods that modify the same assets. ⚠️Note: Avoid using tools like LOOT with Nolvus.</li>' +
					'<li>If the problem persists, consider disabling mods one by one to isolate the conflicting mod.</li>' +
					'<li>List of mentioned meshes: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						 extractNifPathsToListItems(logsTopHalf) +
					'</ul></ol></li>';
				insightsCount++;
			}

			//Bad texture
			if (logsTopHalf.toLowerCase().includes('CompressedArchiveStream'.toLowerCase())) {
				insights += '<li>❓ <b>CompressedArchiveStream Issue Detected:</b> This error typically points to a <b>corrupted texture</b> file, which can occur when a mod improperly overwrites textures from the game or its DLCs. To resolve this issue, follow these steps:<ol>' +
					'<li>Identify if a DLC texture is being overwritten by checking the load order and mod descriptions.</li>' +
					'<li>If no specific texture name is mentioned, extract the "*.BSA" archives linked with any "*.esp" or "*.esm" files, excluding those from official DLCs, to pinpoint the corrupted file.</li>' +
					'<li>Temporarily disable texture mods that are associated with the crash location to see if the issue is resolved.</li>' +
					'<li>Use tools like BSA Browser to safely extract and inspect the contents of "*.BSA" files.</li>' +
					'<li>Consult mod forums and communities for known issues with specific texture files and recommended solutions.</li>' +
					'<li>List of mentioned textures: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						extractSkyrimTexturePathsToListItems(logsTopHalf) +
					'</ul></ol></li>';
				insightsCount++;
			}

			//Textures
			if (logsTopHalf.toLowerCase().includes('texture')) {
				insights += '<li>❓ <b>Texture Issue Detected:</b> The mention of \'textures\' in the crash log indicates a potential problem related to texture files. Textures play a crucial role in the visual quality of Skyrim, affecting everything from character models to landscapes and objects. To address texture-related issues, consider the following steps:<ol>' +
					'<li><a href="https://www.nexusmods.com/skyrimspecialedition/mods/23316">Cathedral Assets Optimizer (CAO)</a> can often be used to repair damaged image files. CAO ensures that textures are properly formatted and can also reduce their resolution (file size) without noticeably reducing visual quality.</li>' +
					'<li>Check your mod load order to prevent texture conflicts. Ensure that texture mods are loaded after any mods that alter the same textures.</li>' +
					'<li>Inspect the list of textures mentioned in the crash log. These textures may be associated with specific mods or locations.</li>' +
					'<li>Consider using lower resolution texture packs (e.g., 2K textures) if you experience performance or stability issues. High-resolution textures (e.g., 4K) can strain both your system\'s RAM and VRAM.</li>' +
					'<li>Temporarily disable texture mods associated with the crash location to see if the issue is resolved.</li>' +
					'<li>Consult Skyrim modding forums and communities for specific advice related to texture troubleshooting.</li>' +
					'<li>List of mentioned textures: <a href="#" class="toggleButton">⤴️ hide</a><ul class="extraInfo">' + 
						extractSkyrimTexturePathsToListItems(logsTopHalf) +
					'</ul></ol></li>';
				insightsCount++;
			}




			insights += '</ul><h5>Mod-specific Issues:</h5><ul>';

			//Monster Mod
			if (logsFirstLine.includes('5999C7') || logsFirstLine.includes('D02C2C')) {
				insights += '<li>❓ <b>5999C7 or D02C2C Detected:</b> These errors are often related to <b>"Monster Mod.esp"</b>. This mod is commonly thought to cause numerous errors and crashes to desktop (CTD), even with unofficial patches and the latest updates. If you prefer to keep the mod, consider the following steps:<ol>' +
					'<li>Ensure you have the latest version of the mod installed.</li>' +
					'<li>Apply any available unofficial patches that may address known issues.</li>' +
					'<li>Check for compatibility with other mods and load order. ⚠️Note: Avoid using tools like LOOT with Nolvus.</li>' +
					'<li>If crashes persist, consider removing the mod and cleaning your save file with a tool like FallrimTools.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Lanterns Of Skyrim II
			if (logsTopHalf.toLowerCase().includes('lanterns\\lantern.dds') || logsTopHalf.toLowerCase().includes('Lanterns Of Skyrim II.esm'.toLowerCase())) {
				insights += '<li>❓ <b>Possible Lanterns Of Skyrim II Issue Detected:</b> If you\'re using both the mods "Lanterns of Skyrim II" (LoS II) and "JK Skyrim," exercise caution when installing the "No Lights Patch." The LoS II patch is specifically designed to be used without the "No Lights Patch." Installing both may lead to conflicts or unexpected behavior related to lantern textures and lighting in your game. To avoid issues, follow these steps:<ol>' +
					'<li>Check the mod descriptions and compatibility notes for both "Lanterns of Skyrim II" and "JK Skyrim."</li>' +
					'<li>If you intend to use the "No Lights Patch," ensure that it is compatible with both mods.</li>' +
					'<li>If conflicts persist, consider using alternative patches or adjusting your mod load order.</li>' +
					'<li>Note: "Lanterns of Skyrim II" mod is not present in vanilla Nolvus.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//ImprovedCameraSE
			if (logsTopHalf.toLowerCase().includes('ImprovedCameraSE.dll'.toLowerCase())) {
				insights += '<li>❓ <b>ImprovedCameraSE.dll+ Issue Detected:</b> The presence of \'ImprovedCameraSE.dll+\' in the crash log indicates an error related to the **Improved Camera SE** mod. This mod enhances the in-game camera functionality, allowing for more dynamic and immersive views. However, pinpointing the exact cause of this error can be challenging. Here are some potential solutions to consider:<ol>' +
					'<li>Add \'-forcesteamloader\' to your SKSE (Skyrim Script Extender) launch arguments. This flag ensures that SKSE uses the Steam loader, which can resolve compatibility issues with certain mods.</li>' +
					'<li>Modify ReShade\'s INI file: Look for the \'MenuMode\' setting and change it to \'0\'. This adjustment might prevent conflicts between ReShade and Improved Camera SE.</li>' +
					'<li>If issues persist, seek assistance on the mod\'s support page or community forums. Other users may have encountered similar problems and can provide specific advice.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			/* 	DISABLED: as (1) is well tested as part of vanilla Nolvus, (2) doesn't have a specific fix, and (3) is not a common issue (if at all?)
				//Skyrim Unbound
				if (logsTopHalf.includes('Skyrim unbound')) {
					insights += '<li><b>Skyrim Unbound Issue Detected:</b> The mention of \'Skyrim Unbound\' in the crash log indicates a potential issue related to this mod. If you\'re experiencing problems, consider installing one of the available fixes specifically designed for Skyrim Unbound. These fixes address common issues and enhance compatibility with other mods.</li>';
					insightsCount++;
				}
			*/

			//SimplestHorses.esp
			if (relevantObjectsSection.toLowerCase().includes('SimplestHorses.esp'.toLowerCase())) {
				insights += '<li>❓ <b>Potential Conflict with Simplest Horses:</b> This crash occurs on customized lists and is speculated to be the result of a conflict between Simplest Horses and certain additional mods. If issue persists try disabling either your recently added mod(s), or these two mods: <ol><li>Simplest Horses</li><li>Simplest Horses - Animated Whistling Patch</li></ol></li>';
				insightsCount++;
			}

			//Animated Ice Floes.esp
			if (relevantObjectsSection.toLowerCase().includes('Animated Ice Floes.esp'.toLowerCase())) {
				insights += '<li>❓ <b>Potential Conflict with Animated Ice Floes:</b> This crash occurs on customized lists and is speculated to be the result of a conflict between Animated Ice Floes and certain additional mods. If issue persists try disabling either your recently added mod(s), or the Animated Ice Floes mod.</li>';
				insightsCount++;
			}


			insights += '</ul><h5>Miscellaneous Issues:</h5><ul>';

			//Shadowrend
			if (relevantObjectsSection.toLowerCase().includes('ccbgssse018-shadowrend.esl')) {
				insights += '<li>❓ <b>Possible Shadowrend Crash Detected:</b> The presence of \'ccbgssse018-shadowrend.esl\' in the crash log suggests an issue related to the Shadowrend weapon. To address this issue:<ol>' +
					'<li>Load an earlier save that predates the crash.</li>' +
					'<li>Travel to a different cell (area) from where the original crash occurred.</li>' +
					'<li>Play for a few in-game days away from the area where Shadowrend is involved. This may allow the issue to resolve itself.</li>' +
					'<li><b>Be cautious</b> when loading a save that previously experienced the Shadowrend crash. Continuing to play on such a save might compound the issue, leading to more frequent crashes.</li>' +
					'<li>Note that while Shadowrend often appears in crash logs, it may not always be the direct cause of the crash. Other factors, such as load order conflicts, can also contribute.</li>' +
					'</ol>For more detailed information and troubleshooting tips, refer to the <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-6">Shadowrend Crash section</a> on the Nolvus support page.</li>';
				insightsCount++;
			}

			//Forced Termination
			if (logsFirstLine.includes('0CB748E')) {
				insights += '<li>❓ <b>0CB748E Detected:</b>This type of crash is often not indicative of a problem within the game itself but rather the result of the game\'s process being <b>forcibly terminated</b>. When Skyrim is closed in this manner, it doesn\’t go through the normal shutdown sequence, which can result in incomplete or corrupted data being written to the crash log.</li>';
				insightsCount++;
			}

			//Animation Issue
			if (logsFirstLine.includes('67B88B')) {
				insights += '<li>❓ <b>67B88B Detected:</b> This error is often linked to issues with the <b>"AnimationGraphManagerHolder"</b> callstack, which can occur when there are conflicts between animation mods or when an animation mod fails to overwrite vanilla animations properly. To resolve this:<ol>' +
					'<li>Regenerate animations using FNIS (Fores New Idles in Skyrim) or Nemesis (as is used by vanilla Nolvus).  Follow these instructions for <a href="https://www.nolvus.net/guide/asc/output/nemesis">regenerating Nemesis for Nolvus</a>.</li>' +
					'<li>Ensure that the FNIS.esp file is not deleted, as it is generated by FNIS/Nemesis and is necessary for the animations to work correctly.</li>' +
					'<li>Check for updates or patches for your animation mods, especially if you have recently installed or updated other mods that may affect animations.</li>' +
					'<li>If the issue persists, consider disabling recent animation mods one by one to identify the culprit.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//SSE Engine Fixes and Equipment Durability System
			if (logsFirstLine.includes('7428B1')) {
				insights += '<li>❓ <b>7428B1 Detected:</b> This error is often connected to issues with the <b>"SSE Engine Fixes"</b> mod. To troubleshoot, consider the following steps:<ol>' +
					'<li>Check if you are using the <b>"Equipment Durability System"</b> mod, which can cause issues when an enchanted weapon breaks.</li>' +
					'<li>Look for conflicts with other mods that modify characters while they are holding a weapon. This includes mods that alter animations, equipment, or character models.</li>' +
					'<li>Ensure that "SSE Engine Fixes" is properly installed and configured according to the latest instructions provided by the mod author.</li>' +
					'<li>If the problem persists, try disabling the "Equipment Durability System" mod and any other recently added mods one by one to identify the conflict.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//SSE Engine Fixes and SSE Display Tweaks
			if (logsFirstLine.includes('8BDA97')) {
				insights += '<li>❓ <b>8BDA97 Detected:</b> This error may be due to a conflict between <b>"SSE Engine Fixes" and "SSE Display Tweaks"</b> mods. To address this issue:<ol>' +
					'<li>Review the settings in both mods and ensure they are not set to override each other.</li>' +
					'<li>Consult the documentation for each mod to understand the recommended settings for compatibility.</li>' +
					'<li>Check for any updates or patches that might resolve known conflicts between these mods.</li>' +
					'<li>If the issue persists, consider using one mod at a time to identify which settings are causing the conflict.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Hotkeys
			if (logsFirstLine.includes('C1315C')) {
				insights += '<li>❓ <b>C1315C Detected:</b> This error is often related to modifications in the "controlmap.txt" file, which can be altered by mods that utilize <b>hotkeys</b>. To troubleshoot this issue:<ol>' +
					'<li>Identify any mods that have been recently installed or updated, which may modify the "controlmap.txt" file.</li>' +
					'<li>Check the mod descriptions and documentation for any known issues or specific instructions regarding the "controlmap.txt" file.</li>' +
					'<li>Consider reverting "controlmap.txt" to its original state or using a backup if available.</li>' +
					'<li>If the problem persists, disable the suspected mods one by one to identify the culprit.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Save game issues
			if (logsFirstLine.includes('D2B923')) {
				insights += '<li>❓ <b>D2B923 Detected:</b> This error is often linked to <b>save game issues</b>. It may be associated with mods that alter the save system, such as "Save System Overhaul (SSO)" or "Alternate Start - Live Another Life (LAL)". A potential fix for users experiencing flashing savegame entries with SkyUI SE is the "SkyUI SE - Flashing Savegames Fix". If you\'re using a version of Skyrim SE or AE before v1.6.1130, this fix should work. For later versions, the "SkyUI SE - Difficulty Persistence Fix" is recommended, which includes the flashing savegames fix. Also, if you aren\'t aware of (and diligently following) <b>Jerilith\'s Safe Save Guide</b>, review it at <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-5">Save Bloat Crash</a/>.</li>';
				insightsCount++;
			}

			//Save game issue 2
			if (logsTopHalf.toLowerCase().includes('BGSSaveLoadManager'.toLowerCase())) {
				insights += '<li>❓ <b>BGSSaveLoadManager Issue Detected:</b> This error is associated with problems in the <b>save game</b> system. If you aren\'t aware of (and diligently following) <b>Jerilith\'s Safe Save Guide</b>, review it at <a href="https://www.nolvus.net/catalog/crashlog?acc=accordion-1-5">Save Bloat Crash</a/>. Issue may manifest as corrupted saves or issues when loading games. To potentially resolve this, you can try the following after loading the last working save:<ol>' +
					'<li>Open the console in-game by pressing the tilde (~) key.</li>' +
					'<li>Type the command "player.kill" and press Enter. This will kill your character and force the game to reload.</li>' +
					'<li>After the game reloads, check if the issue with saving or loading persists.</li>' +
					'<li>If problems continue, consider reverting to an earlier save or using save cleaning tools to remove orphaned scripts and other potential corruptions.</li>' +
					'<li>Always keep backups of your saves before attempting fixes or using cleaning tools.</li>' +
					'</ol>Note: This method is experimental and may not work for all users. It is recommended to seek further assistance from the Skyrim modding community if save game issues are persistent.</li>';
				insightsCount++;
			}

			//SKSE
			if (logsTopHalf.toLowerCase().includes('skse64_loader.exe')) {
				insights += '<li>❓ <b>skse64_loader.exe Issue Detected:</b> This entry suggests that there may be an issue with <b>SKSE (Skyrim Script Extender)</b> or a mod that utilizes it. Common troubleshooting steps include:<ol>' +
					'<li>Ensuring that SKSE is properly installed and that you are launching Skyrim through the SKSE launcher.</li>' +
					'<li>Checking that your version of SKSE matches your version of Skyrim SE/AE.</li>' +
					'<li>Verifying that all mods dependent on SKSE are up to date and compatible with your current game version.</li>' +
					'<li>Running Skyrim as an administrator, which can sometimes resolve permission issues with SKSE.</li>' +
					'<li>Adding exceptions for SKSE and your mod manager in your security software to prevent interference.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//HDT-SMP (Skinned Mesh Physics)
			if (logsTopHalf.toLowerCase().includes('hdtSMP64.dll'.toLowerCase())) {
				insights += '<li>❓ <b>hdtSMP64.dll Issue Detected:</b> Frequent occurrences of this error might suggest a configuration issue or indicate <b>physics</b> issues with NPCs wearing <b>HDT/SMP</b> enabled armor/clothing/hair. To troubleshoot this issue:<ol>' +
					'<li>Ensure that \'hdtSMP64.dll\' is compatible with your installed versions of SkyrimSE.exe and SKSE. Incompatible DLLs can lead to crashes.</li>' +
					'<li>Check for any recent updates or patches for the mod associated with \'hdtSMP64.dll\'.</li>' +
					'<li>Review your mod configuration settings, especially those related to HDT/SMP, to ensure they are set up correctly.</li>' +
					'<li><b>Workaround:</b> Sometimes, wearing all non-physics armor/clothing/wigs/equipment can alleviate problems with physics. Also, if you or a follower has physics-enabled hair, try wearing a non-physics helmet to cover it up.</li>' +
					'<li><b>Alternatively,</b> reinstall Nolvus without Advanced Physics to prevent any such future issues.</li>' +
					'<li>If the issue persists, consider disabling mods that use HDT/SMP one by one to identify the source of the problem.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//cbp.dll Issue
			if (logsTopHalf.toLowerCase().includes('cbp.dll')) {
				insights += '<li>❓ <b>cbp.dll Issue Detected:</b> Frequent appearances of this error might suggest a configuration issue or indicate <b>physics</b> issues with NPCs are wearing <b>SMP/CBP</b> enabled clothing. To troubleshoot this issue:<ol>' +
					'<li>Ensure that \'cbp.dll\' is compatible with your installed versions of SkyrimSE.exe and SKSE. Incompatible DLLs can lead to crashes.</li>' +
					'<li>Check for any recent updates or patches for the mod associated with \'cbp.dll\'.</li>' +
					'<li>Review your mod configuration settings, especially those related to CBP, to ensure they are set up correctly.</li>' +
					'<li><b>Workaround:</b> Sometimes, wearing all non-physics armor/clothing/wigs/equipment can alleviate problems with physics. Also, if you or a follower has physics-enabled hair, try wearing a non-physics helmet to cover it up</li>' +
					'<li><b>Alternatively,</b> reinstall Nolvus without Advanced Physics to prevent any such future issues.</li>' +
					'<li>If the issue persists, consider disabling mods that use CBP one by one to identify the source of the problem.</li>' +
					'<li>Some users have reported success by restarting their PC, renaming \'cbp.dll\' to something else to force a different load order, or verifying the integrity of game files on Steam if there\'s a suspicion of file corruption.</li>' +
					'</ol></li>';
				insightsCount++;
			}


			//0x0 on thread (Lighting or Shadows)
			if (logsTopHalf.toLowerCase().includes('0x0 on thread')) {
				insights += '<li>❓ <b>0x0 on thread Issue Detected:</b> This rare engine issue is often related to face lighting or shadow problems. To mitigate this issue, follow these steps:<ol>' +
					'<li>Ensure you have the latest version of <a href="https://www.nexusmods.com/skyrimspecialedition/mods/17230">SSE Engine Fixes</a> installed. Engine Fixes addresses various bugs and patches issues in Skyrim Special Edition.</li>' +
					'<li>Check for any conflicting mods that may affect lighting or shadows. Disable or adjust mods related to lighting, weather, or visual enhancements.</li>' +
					'<li>Verify that your graphics drivers are up-to-date, as outdated drivers can sometimes cause graphical glitches.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//HUD
			//Merged with test thought up by AI (MS Bing Copilot):
			const hudRelatedRegex = /HUD|menus|maps/ig;
			var hudRelatedMatches = logsTopHalf.match(hudRelatedRegex) || [];
			if (hudRelatedMatches.length > 0) {
				insights += '<li>❓ <b>HUD Issue Detected:</b> The error suggests a conflict with your HUD/UI. To troubleshoot this issue, consider the following steps:<ol>' +
					'<li>Check for any mods that alter the HUD or user interface. Disable or adjust these mods to see if the issue persists.</li>' +
					'<li>Ensure that you have the latest version of SkyUI installed. Sometimes outdated versions can cause HUD-related problems.</li>' +
					'<li>Verify that your SKSE (Skyrim Script Extender) is up-to-date, as it\'s essential for many mods, including SkyUI.</li>' +
					'<li>If you\'re using other HUD-related mods, ensure they are compatible and load them in the correct order.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//XPMSE
			if (logsTopHalf.toLowerCase().includes('XPMSE'.toLowerCase())) {
				insights += '<li>❓ <b>XPMSE Issue Detected:</b> The mention of \'XPMSE\' in the crash log suggests a potential conflict or issue with the XP32 Maximum Skeleton Extended mod or its dependencies. This mod is crucial for animation support and is often required by other mods that add or modify character animations. To address this issue, consider the following steps:<ol>' +
					'<li>Ensure that XPMSE is installed correctly and is loaded at the correct point in your mod load order.</li>' +
					'<li>Verify that all mods requiring XPMSE as a dependency are compatible with the version you have installed.</li>' +
					'<li>Update XPMSE and any related mods to their latest versions.</li>' +
					'<li>If you have recently added or removed mods, check for any that might affect skeleton or animation files and adjust accordingly.</li>' +
					'<li>Consult the mod descriptions and community forums for specific troubleshooting steps related to XPMSE.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//XAudio
			if (logsTopHalf.toLowerCase().includes('XAudio'.toLowerCase())) {
				insights += '<li>❓ <b>XAudio Issue Detected:</b> The \'XAudio\' error indicates a problem with the game\'s audio processing components. XAudio is a part of the Windows audio infrastructure, separate from DirectX. To resolve audio issues, follow these steps:<ol>' +
					'<li>Download and install the latest version of the XAudio redistributable that is compatible with your operating system.</li>' +
					'<li>Ensure your sound card drivers are up to date. Visit the manufacturer\'s website for the latest driver software.</li>' +
					'<li>If you\'re using audio mods, verify their compatibility with your version of Skyrim and other installed mods.</li>' +
					'<li>Check the game\'s audio settings and adjust them if necessary. Sometimes, changing the audio format can resolve issues.</li>' +
					'<li>Consult the Skyrim modding community forums for specific solutions to XAudio-related errors.</li>' +
					'</ol></li>';
				insightsCount++;
			}


			//keyboard
			if (logsTopHalf.toLowerCase().includes('bswin32keyboarddevice')) {
				insights += '<li>❓ <b>bswin32keyboarddevice Issue Detected:</b> The error related to \'bswin32keyboarddevice\' typically indicates a problem with the keyboard input system within the game. While this issue can sometimes be resolved with a simple computer restart, there are additional steps you can take if the problem persists:<ol>' +
					'<li>Restart your computer to refresh the system and potentially resolve any temporary conflicts.</li>' +
					'<li>Check for update	s to your keyboard drivers and install them if available.</li>' +
					'<li>Ensure that Skyrim and any related mods are up to date.</li>' +
					'<li>If you are using mods that affect keyboard inputs or hotkeys, verify their compatibility and settings.</li>' +
					'<li>Consult the modding community forums for any known issues with \'bswin32keyboarddevice\' and potential fixes.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			//Overlays
			if (logsTopHalf.toLowerCase().includes('overlay') || logsTopHalf.toLowerCase().includes('discordhook64.dll')) {
				insights += '<li>❓ <b>Potential Overlay Issue Detected:</b> Crashes with \'gameoverlayrenderer64.dll\' or \'discordhook64.dl\' (or the like) in their log files may relate to use of an overlay. Try playing Skyrim with any overlays disabled to see if it helps.</li>';
				insightsCount++;
			}

			//DynDOLOD
			if (logsTopHalf.toLowerCase().includes('DynDOLOD.esm'.toLowerCase())) {
				insights += '<li>❓ <b>DynDOLOD.esm Issue Detected:</b> The \'DynDOLOD.esm\' error is known to cause crashes to desktop (CTDs) when transitioning between locations, especially when autosave occurs concurrently with script execution. This can be due to the mod making extensive changes to the game\'s LOD (Level of Detail) which can be resource-intensive. To mitigate this issue:<ol>' +
					'<li>Disable autosave in the game settings, particularly when changing locations or fast traveling.</li>' +
					'<li>Manually save your game at regular intervals to avoid losing progress.</li>' +
					'<li>Ensure that \'DynDOLOD.esm\' is properly installed and that you have the latest version.</li>' +
					'<li>Check for any updates or patches that may address known issues with this mod.</li>' +
					'<li>Consider <a href="https://www.nolvus.net/guide/asc/output/dyndolod">regenning DynDOLOD</a>?</li>' +
					'<li>If the problem persists, seek assistance on the mod\'s official support forum. Provide detailed information about your issue and any relevant crash logs for further investigation.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			// Check thought up by AI (MS Bing Copilot):
			//ObjectReference Issues
			const objectReferenceRegex = /kDeleted|TESLevItem/ig;
			var objectReferenceMatches = logsTopHalf.match(objectReferenceRegex) || [];
			if (objectReferenceMatches.length > 0) {
				insights += '<li>❓ <b>ObjectReference Issues Detected:</b> The presence of ' + objectReferenceMatches.length + ' ObjectReference keyword(s) suggests crashes related to specific objects or records. To troubleshoot this:<ol>' +
					'<li>Search the crash log for keywords like <b>"kDeleted"</b> or <b>"TESLevItem"</b> which indicate missing or corrupted game objects.</li>' +
					'<li>Review the involved plugins (mods) and their load order to ensure there are no conflicts or missing dependencies.</li>' +
					'<li>Use mod management tools to verify the integrity of the mods and resolve any conflicts.</li>' +
					'<li>If a particular object or record is consistently involved in crashes, consider removing or replacing the mod that contains it.</li>' +
					'</ol></li>';
				insightsCount++;
			}

			/*DISABLED UNTIL I CAN FIND EXAMPLES SO I CAN LIST THE MISSING/CORRUPTED OBJECTS:
				  // Check thought up by AI (MS Bing Copilot):
				//ObjectReference Issues 2
				if (objectReferenceMatches.length > 0) {
					const missingOrCorruptedObjects = objectReferenceMatches.map(match => match === 'kDeleted' ? 'missing' : 'corrupted');
					const uniqueObjects = [...new Set(missingOrCorruptedObjects)];
			
					insights += '<li><b>ObjectReference Issues Detected:</b> The presence of ' + objectReferenceMatches.length + ' ObjectReference keyword(s) suggests crashes related to specific objects or records. To troubleshoot this:<ol>' +
						'<li>Search the crash log for keywords like <b>"kDeleted"</b> or <b>"TESLevItem"</b> which indicate ' + (uniqueObjects.length === 1 ? 'the following issue:' : 'the following issues:') + '</li>' +
						'<li><ul>';
			
					if (uniqueObjects.includes('missing')) {
						insights += '<li><b>Missing Objects:</b> These "missing" objects are referenced but not found in the game. Check if any required mods or assets are missing or disabled.</li>';
					}
			
					if (uniqueObjects.includes('corrupted')) {
						insights += '<li><b>Corrupted Objects:</b> These "corrupted" objects may be damaged or incorrectly modified. Investigate the involved plugins (mods) and their load order.</li>';
					}
			
					insights += '</ul></li>' +
						'<li>Use mod management tools to verify the integrity of the mods and resolve any conflicts.</li>' +
						'<li>If a particular object or record is consistently involved in crashes, consider removing or replacing the mod that contains it.</li>' +
						'</ol></li>';
					insightsCount++;
				} */


			/* 	DISABLED TEST ... AI thought it up, and I can't even get it to throw even on a mockup test.log and even with AI's help
				//WILL THIS ONE EVER ACTUALLY FIND ANYTHING?
				// Check thought up by AI (MS Bing Copilot):
				//File Format Version Mismatch
				const frameworkVersionRegex = /ApplicationVersion: (\\d+\\.\\d+\\.\\d+\\.\\d+)/;
				var frameworkVersionMatch = logsTopHalf.match(frameworkVersionRegex);
				var gameVersion = frameworkVersionMatch ? frameworkVersionMatch[1] : 'unknown'; // Fallback to 'unknown' if not found
			
				const fileFormatVersionMismatchRegex = /File Format Version: (\\d+\\.\\d+)/g;
				var fileFormatVersionMatches = logsTopHalf.match(fileFormatVersionMismatchRegex) || [];
			
				if (fileFormatVersionMatches.length > 0 && gameVersion !== 'unknown') {
					var mismatchedFiles = fileFormatVersionMatches.filter(match => !match.includes(gameVersion));
					insights += '<li><b>File Format Version Mismatch Detected:</b> Incompatible file format versions can lead to crashes. To troubleshoot:<ol>' +
						'<li>Check the file format versions listed in the crash log against your game version (' + gameVersion + ').</li>' +
						'<li>If mismatches are found, consider updating the files or mods to ensure compatibility.</li>' +
						'<li>Installing <a href=\\"https://www.nexusmods.com/skyrimspecialedition/mods/21146\\">Backported Extended ESL Support (BEES)</a> may help load older files safely.</li>' +
						'</ol>' +
						(mismatchedFiles.length > 0 ? '<p>The following file(s) have mismatched versions:</p><ul>' + mismatchedFiles.map(file => '<li>' + file + '</li>').join('') + '</ul>' : '') +
						'</li>';
					insightsCount++;
				} END DISABLED TEST */




			var outputHtml = '<ul>' + diagnoses + '</ul>';
			document.getElementById('result').innerHTML = outputHtml;

			if (document.getElementById('speculativeInsights').checked) {
				if (insights.trim() !== '') {
					outputHtml = '<h4>For Advanced Users:</h4>⚠️<b>CAUTION:</b> some of the instructions below (and a few of their tests) were generated by an AI system ... so they could potentially be giving bad advice. If you aren\'t confident in what you are doing, please consult with the Nolvus modding community before making any significant changes to mods added by vanilla Nolvus.' + insights + '</ul>';
					showH4();
					document.getElementById('speculation').innerHTML = outputHtml;
				}
			}

			console.log('Speculative Insights:', insightsCount);
			console.log('Speculative Insights - diagnosesCount =', insightsCount - diagnosesCount);

			showCopyDiagnosesButton();
			addEmojiClickEvent();
		}

		// - - - TODOs - - -

		// ✅ Beta version 0.13.2
		// ✅ Added bold formatting to the 'be cautious' warning in the second listing of Shadowrend
		// ✅ Added clarification to the Shadowrend description: ... "frequently NOT the crash culprit when other issues are present."...
		// ✅ Better wording for "❓Possible Skeleton Issue: Detected 1 potential cause(s). " --> "Detected 1 potential indicators(s). Multiple indicators are more likely to be the cause than just one. Restarting may help if you\'re using vanilla Nolvus. For custom mods, verify your load order. Skeleton Issues are frequently NOT the crash culprit when other issues are present."
		// ✅ Disabled the URL /?Advanced safety lockout of the "Advanced Users" section (it now seems ready for public use, and has plenty of warnings on it)
		// ✅ Relabeled "Speculations for Advanced Users" to just "Advanced Users" and slightly softened the warning.

		// ⭐ Show count for Higher-Confidence Test: ❗Potentially Misorganized Vanilla Nolvus Plugins
			// Maybe show those files again?
		// ⭐ Maybe write a looper that loops through the top log segments and adjusts importance of the issue according to how high-up it is in the log
			// AND/OR maybe color-code the output in Files/Elements? Somehow indicate how high up each item was found. 🔴🟠🟡🟢🔵🟣
		// ⭐ If url ends in # then remove the # (sometimes happens and messes up the advanced features checkbox)
		// ⭐ text change: All Vanilla Nolvus Plugins are Well Ordered  --> Tested Vanilla Nolvus Plugins are All Well Ordered (unless too long?)


		// ⏸️ (NOT EASY?)  New feature that if tests are positive in the first line of the crash log, then elevat that test to the More Definitive tests section.
			// ⏸️ EASY APPROACH: maybe make two versions of each applicable test? One that tests the first line, and another below that tests more broadly (but not the first line so as to avoid showing duplicates)
				//👍 But could set a description variable in the High-Confice test, and then just call that variable for the description in the lower confidence test. Best to keep descriptions in one place.
			// ⏸️⏸️⏸️   BIG REFACTORING APPROACH: maybe switch over to giant mapping of tests like that one analyzer used? That's a big project though. BUt could be easier in the long run?
			// Move the speculative warning further down the list?


		// ⏸️ Potential bug in hasPhysics??? ⭐ (jax showed Advanced Physics as off, but one of his logs had a seemingly Physics-related crash? He's the kernalbase one.)

		// ⏸️ Review all Advanced insights for formatting fixes, and for applicability to Nolvus.

		// FEASIBLE? Gather list of always-install Plugins? List of removed vanilla Nolvus plugins? https://discord.com/channels/740569699900719145/1168063977029382235/1234896387888517291	
			// Strip out the non-"Always Install" plugins from "vanillaNolvusPlugins - AlwaysInstall.txt"
	
		// New ?Helper version with Discord help codes:  https://discord.com/channels/740569699900719145/1229319785758851082/1234882170456375338

		// Catchup at: https://discord.com/channels/740569699900719145/755346172243214376/1234566499629273170



		// ⏸️ ?Test and log insight for ENB version?
		// ⏸️ New tests for Disco's patches which are recommended in this analyzer ... and alter diagnosis if patch is already present.
		// ⏸️ ?Maybe shorten the Log Insights to just show the true indicators? Skip the false ones?
		// ⏸️ Adjust number of expected mods around that ... and add plus or minus numbers for Ultra Wide, or other hardware options, configs etc. Plus add numbers for Skyrim, SE, CC, Dawnguard, Hearthfire, Dragonborn, and any other base mods that are always there
		// ⏸️ Expanded troubleshooting advice for "Apply Order" with something like: "If this issue persists after a "Apply Order" ... reinstall Nolvus (much faster from Archives)""
		// ⏸️ More tests for "Apply Order": "Game plugins (81)"" vs "Game plugins (2343)" ... clearly 81 (from Alphabetized - Crash_2024_4_20_22-21-11.txt) is wayyyy too few


		//Coming soon:
		// ⏸️ Link to a user-friendly change log

		// - - - FUTURE FEATURES? - - -
		// ⏸️Special code for Google Analytics conversions and clicks and stuff? (conversion would be a following a diagnosed link to Nolvus.net? CLick would be doing an analysis? Need to read up on the Google Analytics docs.
		// ⏸️[INFEASIBLE?] Color syntaxing? Maybe output the "Possible relevant objects" section and the "Probable callstack" with the non-null single quoted names and filenames? Probably need to collect more crash logs from different sources before deciding? 
		// ⏸️Custom mod found in Probable Callstack:  "In customized you’ll likely find that there will be many direct mod related crashes which will list themselves. Most of the time it’s as simple as disabling or adjusting the load order of referenced mod" (description from Corrupt Bliss)
		// ⏸ Find new tests/features in any other Skyrim crash-analysis mods?
		// ⏸ Somehow extract mod names from Probable Callstack and above ... and list the ones that show up with their number of occurences?
		// ⏸ [INFEASIBLE?] Check for updated version on GitHub? (and alerts user to self-refresh if file is old)
		// ⏸ New FaceGen Crash, counting "FaceGen" occurences. Indicate as possible crash. Pending troubleshooting advice. See "maybe Skeleton or Facegen - Crash_2024_4_13_14-6-0.txt"

	</script>
</head>


<body>
	<header>
		<h1>Phostwood's Unofficial Nolvus Crash Log Analyzer</h1>
	</header>
	<main>
		<section>
			<p id="versionNumber"></p>
			<p>
				<strong>Find your crash logs at:</strong><br>
				<code
					id="crashDirectory">[YOUR_DRIVE]\Nolvus\Instances\Nolvus Ascension\MODS\overwrite\NetScriptFramework\Crash</code><br>
				Or, alternately, download the <a
					href="https://raw.githubusercontent.com/Phostwood/crash-analyzer/main/Test_Log.txt">Test_Log.txt</a>
				to see every possible crash log issue.
			</p>
			<input type="file" id="fileInput" style="display:none;" onchange="loadFile(event)" accept=".txt">
			<button onclick="document.getElementById('fileInput').click();">Choose File</button>
			<div id="filename"></div>
			<textarea id="crashLog" rows="10" cols="50"
				placeholder="Choose file (above), or drag-and-drop your log file onto this field, or copy-paste your Nolvus crash log content here..."></textarea><br>
			<button onclick="analyzeLog()">Analyze</button><span id="fileFlags"></span><span style="white-space: nowrap;"> <input type="checkbox" id="speculativeInsights"
					name="speculativeInsights" class="advanced" onchange="analyzeLog()">
				<label for="speculativeInsights" class="advanced">Advanced Users</label></span>
		</section>
		<br>
		(Click on any 🎯, ❗, ❓, 🔎, or ✅ <strong>emoji</strong> next to a diagnosis to copy it, along with its markdown formatting, to your clipboard for sharing in the Nolvus Discord. Please note that any sections you've chosen to "⤴️ hide" will not be included in the copied markdown. This includes both the "⤴️ hide" list item and any indented child list items beneath it.)<br>
		<br>
		<h3>Diagnoses:</h3>
		<button id="convert-button" style="display: none;">Copy Diagnoses</button>
		<article id="result"><code>(click "Choose File" or copy-paste file contents for analyzing)</code><p>&nbsp;</p></article>
		<article id="speculation"></article>
		<h4 class="hidden">Notes:</h4>
		<aside id="footer">
			<p>Not all crash types can be detected with this tool. This automated analysis is very formulaic, and can
				miss subtleties which may be caught by humans.</p>
			<p>For more information on any of these crash types, see <a
					href="https://www.nolvus.net/catalog/crashlog">Nolvus Crash Log Catalog</a>.</p>
			<p>For a <strong>human analysis</strong>, share your crash logs with <a
					href="https://www.reddit.com/r/Nolvus/">r/Nolvus</a> and/or the <a
					href="https://discord.gg/Zkh5PwD">Nolvus Discord</a>.</p>
			<p>If you would like guidance on modding/patching Nolvus, please watch this <a
					href="https://youtu.be/YOvug9KP5L4">brief tutorial video</a> for step-by-step instructions.</p>
			<p>For additional information on installing mods/patches into Nolvus, see <a
					href="https://www.reddit.com/r/Nolvus/comments/1btic4j/how_to_links_for_modding_skyrim_on_top_of_nolvus/">🔧How
					To: Links for Modding Skyrim on top of Nolvus</a>
			<p>
			<p>Please <strong>report any issues</strong> (or share suggestions) in my <a
					href="https://www.reddit.com/r/Nolvus/comments/1bzwo0z/unofficial_nolvus_crash_log_analyzer/">r/Nolvus
					reddit post</a>.</p>
			<p>Thank you to Vektor, Discrepancy, Gaetan, Corrupt Bliss, CJ, and Demognomicon for your documentation and/or assistance!
			</p>
		</aside>
	</main>



	<script>
		function getVersionNumber() {
			var versionNumber = document.querySelector('meta[name="version"]').getAttribute('content');
			var htmlOutput = '(v' + versionNumber + ')';
			//TODO? ⚠️You are using an old version. Please refresh your page.⚠️
			return htmlOutput;
		}
		document.getElementById('versionNumber').innerHTML = getVersionNumber();

		// Functions to show or hide the "Copy Diagnosis" button based on content
		function hideCopyDiagnosesButton() {
			var button = document.getElementById('convert-button');
			button.style.display = 'none';
		}
		function showCopyDiagnosesButton() {
			var button = document.getElementById('convert-button');
			button.style.display = 'inline-block';
		}

		function hideH4() {
			document.querySelectorAll('h4').forEach(function (h4) {
				h4.classList.add('hidden');
			});
		}

		function showH4() {
			document.querySelectorAll('h4').forEach(function (h4) {
				h4.classList.remove('hidden'); // This will remove the 'hidden' class, making the h4 tags visible again
			});
		}




		// Clear results on any change to the textarea field
		function clearResult() {
			// Only clear the result, not the filename
			document.getElementById('result').innerHTML = '<code>(click "Anaylze" button to see results)</code><p>&nbsp;</p>';
			document.getElementById('speculation').innerHTML = '';
			document.getElementById('fileFlags').innerHTML = '';
			hideH4();
			hideCopyDiagnosesButton();
		}

		// - - -  handle drag-and-drop and "Choose File" button  - - - 

		// Functions to handle file selection and load the file content into the textarea
		function displayFilename(fileName) {
			var filenameDisplay = document.getElementById('filename');
			filenameDisplay.innerHTML = '<b>Loaded file:</b> <code></code>';
			var codeElement = filenameDisplay.querySelector('code');
			var textNode = document.createTextNode(fileName);
			codeElement.appendChild(textNode);
		}

		function loadFile(event) {
			var input = event.target;
			var reader = new FileReader();
			reader.onload = function () {
				var text = reader.result;
				document.getElementById('crashLog').value = text;
				displayFilename(input.files[0].name);
				clearResult();
				analyzeLog();
			};
			reader.onerror = function (event) {
				console.error('File reading error:', event.target.error);
			};
			reader.readAsText(input.files[0]);
		}

		// Function to handle drag and drop with visual feedback, file type validation, and filename display
		function handleDragOver(evt) {
			evt.stopPropagation();
			evt.preventDefault();
			evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
		}

		function handleDrop(evt) {
			evt.stopPropagation();
			evt.preventDefault();
			var files = evt.dataTransfer.files; // FileList object.
			if (files.length > 0) {
				var file = files[0];
				if (file.type === 'text/plain') { // Validate file type
					var reader = new FileReader();
					reader.onload = function (event) {
						document.getElementById('crashLog').value = event.target.result;
						displayFilename(file.name);
						clearResult(); // Call clearResult here after setting the value
						analyzeLog();
					};
					reader.onerror = function (event) {
						console.error('File reading error:', event.target.error);
					};
					reader.readAsText(file);
				} else {
					console.error('Unsupported file type:', file.type);
					alert('Unsupported file type. Please select a text file (.txt) containing a NetScriptFramework crash log.');
				}
			}
		}



		// Setup the event listeners for drag and drop with visual feedback
		var dropZone = document.getElementById('crashLog');
		dropZone.addEventListener('dragover', function (evt) {
			handleDragOver(evt);
			this.classList.add('dragover'); // Add class for visual feedback
		}, false);
		dropZone.addEventListener('dragleave', function (evt) {
			this.classList.remove('dragover'); // Remove class when dragging leaves
		}, false);
		dropZone.addEventListener('drop', function (evt) {
			handleDrop(evt);
			this.classList.remove('dragover'); // Remove class on drop
		}, false);

		// Event listener for changes to the textarea
		dropZone.addEventListener('input', function () {
			clearResult()
		}, false);


		// - - -  "Copy Diagnosis" button - - - 

		// Function to remove "⤵️ show more" links and their associated content from HTML
		function removeMoreInfoLinks(html) {
			// Create a temporary DOM to manipulate the HTML string
			var tempDOM = document.createElement('div');
			tempDOM.innerHTML = html;

			// Remove "⤵️ show more" links and their associated content
			var moreInfoButtons = tempDOM.querySelectorAll('a.toggleButton');
			moreInfoButtons.forEach(function(toggleButton) {
				if (toggleButton.textContent === '⤵️ show more') {
					var liNode = toggleButton;
					while (liNode && liNode.nodeName !== 'LI') { // Keep going up until we find an li ancestor
						liNode = liNode.parentNode;
					}
					if (liNode) {
						// Remove the entire list item that contains the "⤵️ show more" link and its associated content
						liNode.parentNode.removeChild(liNode);
					}
				}
			});

			return tempDOM.innerHTML;
		}

		// Function to remove "⤴️ hide" links from HTML
		function removeSkipTheseStepsLinks(html) {
			// Create a temporary DOM to manipulate the HTML string
			var tempDOM = document.createElement('div');
			tempDOM.innerHTML = html;

			// Remove "⤴️ hide" links
			var skipStepsButtons = tempDOM.querySelectorAll('a.toggleButton');
			skipStepsButtons.forEach(function(toggleButton) {
				if (toggleButton.textContent.trim() === '⤴️ hide') {
					toggleButton.remove();
				}
			});

			return tempDOM.innerHTML;
		}

		// Function to convert HTML to Markdown for Discord
		function convertHTMLToMarkdown(html) {
			html = removeMoreInfoLinks(html);
			html = removeSkipTheseStepsLinks(html);

			// Convert the modified HTML to Markdown
			var turndownService = new TurndownService({
				bulletListMarker: '-', // Markdown bullet list marker
				headingStyle: 'atx'    // Markdown heading style
			});

			// Add a rule to handle <a> tags to remove link previews
				turndownService.addRule('noLinkPreview', {
				filter: 'a',
				replacement: function (content, node) {
					return '[' + content + '](' + '<' + node.href + '>' + ')';
				}
			});

			// Create a temporary DOM to manipulate the HTML string
			var tempDOM = document.createElement('div');
			tempDOM.innerHTML = html;

			// Add a rule to ignore elements with 'display: none' style
			turndownService.addRule('ignoreHidden', {
				filter: function(node) {
					var style = node.getAttribute('style');
					if (style) {
						var styles = style.split(';').reduce(function(obj, styleDeclaration) {
							var parts = styleDeclaration.split(':');
							if (parts[0] && parts[1]) {
								obj[parts[0].trim()] = parts[1].trim();
							}
							return obj;
						}, {});
						return styles.display === 'none';
					}
					return false;
				},
				replacement: function (content, node) {
					return '';
				}
			});

			// Add a rule to handle <li> tags for proper line breaks and indentation in Discord
			turndownService.addRule('listItem', {
				filter: 'li',
				replacement: function (content, node) {
					var prefix = '- ';
					var parent = node.parentNode;
					if (parent.nodeName === 'OL' || parent.nodeName === 'UL') {
						var nestingLevel = 0;
						while (parent.parentNode) {
							if (parent.parentNode.nodeName === 'LI' && (parent.nodeName === 'OL' || parent.nodeName === 'UL')) {
								nestingLevel++;
							}
							parent = parent.parentNode;
						}
						prefix = ' '.repeat(nestingLevel * 2) + prefix;
					}
					return prefix + content.trim() + '\n';
				}
			});

			// Remove specific emoji characters (🎯❗❓⚠️)
			//DISABLED:  html = html.replace(/[\uD83C\uDFAF\u2757\u2753\u26A0\uFE0F]/g, '');
			// Remove all non-ASCII characters
			//DISABLED:  html = html.replace(/[^\x00-\x7F]/g, '');

			var markdown = turndownService.turndown(html);
			//replace '\.' with '.' to prevent escaping of periods
			//markdown = markdown.replace(/\\./g, '.');

			// Replace multiple consecutive newline characters with a single newline character
			markdown = markdown.replace(/\n\s*\n/g, '\n');
			
			// Double up backslashes to prevent escaping
			// markdown = markdown.replace(/\\/g, '\\\\');

			return markdown;
		}


		function getResultsHeader() {
			return 'Results from [Crash Log Analyzer ' + getVersionNumber() + '](https://phostwood.github.io/crash-analyzer/):\n\n';
		}

		// Function to copy text to clipboard
		function copyToClipboard(text) {
			var dummy = document.createElement("textarea");
			document.body.appendChild(dummy);
			dummy.value = text;
			dummy.select();
			document.execCommand("copy");
			document.body.removeChild(dummy);
		}

		// Event listener for the "Copy Diagnosis" button
		document.getElementById('convert-button').addEventListener('click', function () {
			// Markdown link to be added at the top of the results
			var resultsHeader = getResultsHeader();
			var htmlContent = document.getElementById('result').innerHTML;
			var markdown = convertHTMLToMarkdown(htmlContent);
			var finalMarkdown = resultsHeader + markdown;
			copyToClipboard(finalMarkdown);
			alert('Markdown copied to clipboard!');
		});


		// Function to show or hide elements with the class 'advanced'
		function toggleAdvancedElements() {
			// Get all elements with the class 'advanced'
			var advancedElements = document.getElementsByClassName('advanced');

			// Determine if the URL ends with '?advanced'
			var shouldDisplay = true; //OLD: window.location.href.toLowerCase().endsWith('?advanced');

			// Loop through the elements and set their display property
			for (var i = 0; i < advancedElements.length; i++) {
				advancedElements[i].style.display = shouldDisplay ? 'inline-block' : 'none';
			}
		}

		// Call the function to toggle the elements
		toggleAdvancedElements();


		// Function to add click event to emojis
		function addEmojiClickEvent() {
			// Get all elements
			var elements = document.querySelectorAll('li, details');
			elements.forEach(function(element) {
				// Check if element contains an emoji
				var regex = /[\u{1F300}-\u{1F5FF}\u{1F600}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu;
				var matches = element.textContent.match(regex);
				if (matches) {
					matches.forEach(function(match) {
						// Create a span for each match
						var span = document.createElement('span');
						span.textContent = match;
						span.style.cursor = 'pointer';
						span.style.position = 'relative';
						span.style.zIndex = '1';

						// Replace the emoji text with the span element
						element.innerHTML = element.innerHTML.replace(new RegExp(match, 'gu'), span.outerHTML);
					});

					// Add click event to each span
					var spans = element.querySelectorAll('span');
					spans.forEach(function(span) {
						span.addEventListener('click', function(event) {
							// Find the closest parent li or details element
							var parentElement = span.closest('li, details');
							if (parentElement) {
								// Convert HTML to Markdown
								var resultsHeader = getResultsHeader();
								var markdown = convertHTMLToMarkdown(parentElement.outerHTML);
								var finalMarkdown = resultsHeader + markdown;
								// Copy to clipboard
								copyToClipboard(finalMarkdown);
								alert('Markdown copied to clipboard!');
							}
							// Stop event propagation
							event.stopPropagation();
						});
					});
				}
			});
		}


		// Call the function when the document is ready
		if (document.readyState === "loading") {  // Loading hasn't finished yet
			document.addEventListener('DOMContentLoaded', addEmojiClickEvent);
		} else {  // `DOMContentLoaded` has already fired
			addEmojiClickEvent();
		}

		window.onload = function() {
			// Set all toggleButtons to display as "⤴️ hide"
			var toggleButtons = document.querySelectorAll('.toggleButton');
			toggleButtons.forEach(function(toggleButton) {
				var extraInfo = toggleButton.nextElementSibling;
				extraInfo.style.display = 'list-item'; // Display the associated extraInfo
				toggleButton.textContent = '⤴️ hide'; // Change the link text
			});

			document.body.addEventListener('click', function(event) {
				if (event.target.className === 'toggleButton') {
					var extraInfo = event.target.nextElementSibling;
					if (extraInfo.style.display === 'none') {
						extraInfo.style.display = 'list-item';
						event.target.textContent = '⤴️ hide'; // Change the link text
					} else {
						extraInfo.style.display = 'none';
						event.target.textContent = '⤵️ show more'; // Change the link text
					}
					event.preventDefault(); // Prevent the default action of the link
				}
			});

			// Default the checkbox to checked if the URL ends with '?advanced'
			if (window.location.href.toLowerCase().endsWith('?advanced')) {
				document.getElementById('speculativeInsights').checked = true;
			}
		};

	</script>

</body>

</html>